[[troubleshooting-osad-jabberd]]
= Troubleshooting OSAD and jabberd




== Open File Count Exceeded

In some cases, the maximum number of files that jabber can open is lower
than the number of connected OSAD clients.

If this occurs, OSAD clients cannot contact the SUSE Manager Server, and
jabberd will take an excessive amount of time to respond on port 5222.

[NOTE]
====
This fix is only required if you have more than 8192 clients connected using
OSAD.  In this case, we recommend you consider using Salt clients instead.
For more information about tuning large scale installations, see
xref:salt:large-scale.adoc[].
====

You can increase the number of files available to jabber by editing the
jabberd local configuration file.  By default, the file is located at
[path]``/etc/systemd/system/jabberd.service.d/override.conf``.



.Procedure: Adjusting the Maximum File Count

. At the command prompt, as root, open the local configuration file for
  editing:
+
----
systemctl edit jabberd
----
. Add or edit this section:
+
----
[Service]
LimitNOFILE=<soft_limit>:<hard_limit>
----
+
The value you choose will vary depending on your environment.  For example,
if you have 9500 clients, increase the soft value by 100 to 9600, and the
hard value by 1000 to 10500:
+
----
[Unit]
LimitNOFILE=
LimitNOFILE=9600:10500
----
. Save the file and exit the editor.

[NOTE]
====
The default editor for systemctl files is vim.  To save the file and exit,
press kbd:[Esc] to enter ``normal`` mode, type kbd:[:wq] and press
kbd:[Enter].
====

Ensure you also update the `max_fds` parameter in
[path]``/etc/jabberd/c2s.xml``.  For example: `<max_fds>10500</max_fds>`

The soft file limit is the maximum number of open files for a single
process.  In {productname} the highest consuming process is ``c2s``, which
opens a connection per client.  100 additional files are added, here, to
accommodate for any non-connection file that ``c2s`` requires to work
correctly.  The hard limit applies to all processes belonging to jabber, and
also accounts for open files from the router, ``c2s`` and ``sm`` processes.







