[server-major-upgrade]
= Server - Major Upgrade

From time to time, {productname} Server upgrades are labeled as major.
This is especially the case, if a version upgrade of openSUSE Leap is needed. openSUSE Leap is the underlying base operating system (OS).

Run the [command]``/usr/lib/susemanager/bin/server-migrator.sh`` script to upgrade the base OS and {productname} Server.

[NOTE]
====
If the [command]``server-migrator.sh`` script is not already installed on your {productname} Server system, update the [package]``susemanager`` package:
+
----
zypper ref
zypper in susemanager
----
====

The [command]``server-migrator.sh`` script will migrate {productname} Server to the latest version.
This implies upgrading the underlying operating system to version 15.2.

// During migration the services need to be shut down and after successful migration the server needs to be rebooted manually.

[IMPORTANT]
====
Because you cannot fix any issues during migration, make sure you have an uptodate backup before starting the migration.
If you are running {productname} Server on a virtual machine, it is recommended to create a snapshot before performing the migration.
====

The script performs the following actions:



== Shut Down {productname} Services

----
spacewalk-service stop
----



==  Adjust Software Repositories for openSUSE Leap 15.2 and {productname}

Move away the old repository configuration:

----
mv /etc/zypp/repos.d /etc/zypp/repos.d.old
mkdir /etc/zypp/repos.d
----

Enable and refresh new repositories:

----
zypper ar -n "Main Repository" http://download.opensuse.org/distribution/leap/15.2/repo/oss repo-oss
zypper ar -n "Main Update Repository" http://download.opensuse.org/update/leap/15.2/oss repo-update
zypper ar -n "Non-OSS Repository" http://download.opensuse.org/distribution/leap/15.2/repo/non-oss repo-non-oss
zypper ar -n "Update Repository (Non-Oss)" http://download.opensuse.org/update/leap/15.2/non-oss/ repo-update-non-oss
zypper ar -n "Uyuni Server Stable" https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable/images/repo/Uyuni-Server-POOL-x86_64-Media1/ uyuni-server-stable

zypper ref
----



== Upgrade Disribution

Perform the distribution upgrade:

----
zypper -n dup --allow-vendor-change
----



== Migrate PostgreSQL Database

To migrate the database to PostgreSQL 12 run the migrate script:

----
/usr/lib/susemanager/bin/pg-migrate-10-to-12.sh
----



== Reboot the System

This is not part of the script.
Initiate the reboot manually:

----
shutdown -r now
----
