[[quickstart-suma-deploy-container]]
= Deploy {productname} {productnumber} Server as a container

This quick start guide shows you how to install and configure a {productname} {productnumber} container for x86-64 architecture on {micro} {microversion}.

For this topic we assume that you already have valid organization credentials with {scc} and have obtained a registration code for both the host system and the containerized server, for example from a "SUSE Manager Lifecycle Management+" subscription.

.Supported operating system for the Container Host
[NOTE]
====
The supported host operating system for your containers is  {micro} {microversion}.
====

.Base operating system for the Container Image
[NOTE]
====
{productname} {productnumber} uses {sle} {bci-suma} as the base operating system of the container image or **BCI**.
====



== Deploying {micro} {microversion}

This section proivdes references for deploying {micro} {microversion}.



=== Container Host general Requirements

For general requirements see, xref:installation-and-upgrade:general-requirements.adoc[General requirements]

[IMPORTANT]
====
To guarantee that clients can resolve the {productname} {productnumber} domain name, both the container server and host machines must be linked to a functional DNS server providing a FQDN. Additionally, it is essential to ensure correct configuration of reverse lookups.
====



[[installation-server-containers-requirements]]
=== Container Host Requirements

For CPU, RAM and storage requirements see, xref:installation-and-upgrade:hardware-requirements.adoc[Hardware requirements]



=== {micro} {microversion} Installation

Get a copy of the {micro} {microversion} install media. You can begin installation on either a virtual machine or on a physical server. 

For detailed documentation on preparing your machines OS (Virutal or physical) See, link:https://documentation.suse.com/sle-micro/5.5/html/SLE-Micro-all/book-deployment-slemicro.html[{micro} {microversion} Deployment Guide]


.Procedure: {micro} {microversion} installation
. Begin installation from media

. Adjust Keyboard and language. Click the [systemitem]``checkbox`` to accept the License Agreement.

. Click [systemitem]``Next`` to continue.

. Select your registration method. For this example we will register the sever with {scc}.

. Enter your {scc} Email address. 

. Enter your registration code for {micro} {microversion}.

. Click [systemitem]``Next`` to continue.

. Select the {productname} {productnumber} Server extension [systemitem]``Checkbox``.

. Click [systemitem]``Next`` to continue.

. Enter your {productname} {productnumber} Server extension registration code.
+

.{productname} as an extension
[NOTE]
====
The {productname} {productnumber} container is installed as an extension. Therefore, in addition to acquiring {scc} registration keys for {micro} {microversion}, you will also need {scc} registration codes for the following extensions:

* {productname} {productnumber} Server
* {productname} {productnumber} Proxy
* Retail Branch Server

====
+

. Click [systemitem]``Next`` to continue.

. Enter or accept default [systemitem]``NTP Server``.

. Click [systemitem]``Next`` to continue.

. Add the [systemitem]``root user`` password twice to confirm.

. Click [systemitem]``Next`` to continue.

. Adjust [systemitem]``Installation Settings`` as required.

. Click [systemitem]``Next`` to continue.

This concludes installation of {micro} {microversion}.



== Deploy {productname} {productnumber} as container on {micro} {microversion}



=== Basic deployment with mgradm

.Procedure: Basic deployment of a {productname} {productnumber} container with Podman
. from the terminal run the following command as the root user.
+

[source, shell]
----
sudo mgradm install podman
----
+

[IMPORTANT]
====
You must deploy the container as sudo or root. The following error will be displayed at the terminal if you miss this step.

[source, shell]
----
INF Setting up uyuni network
9:58AM INF Enabling system service
9:58AM FTL Failed to open /etc/systemd/system/uyuni-server.service for writing error="open /etc/systemd/system/uyuni-server.service: permission denied"
----
====
+

. Enter your servers FQDN.

. Enter a database and certificate password when prompted.

. Wait for deployment to complete.

. Open a browser and proceed to your servers FQDN.

In this section you learned the basic method for deploying a {productname} {productnumber} Server container.



== Create the main administraton account

This section guides you through creating your organization's main administration account for {productname}

.Procedure: Setting Up the Main Administration Account
. In the browser, enter the address provided after completing setup.
    With this address you open the {productname} {webui}.
. In the {webui}, navigate to the menu:Create Organization[Organization Name] field and enter your organization name.
. In the menu:Create Organization[Desired Login] and menu:Create Organization[Desired Password] fields, enter your username and password.
. Fill in the Account Information fields including an email for system notifications.
. Click btn:[Create Organization] to finish creating your administration account.
+
image::quickstart-mgr-setup-admin1.png[scaledwidth=80%]

You are now presented with the {productname} menu:Home[Overview] page.

When you have finished creating the main administrator account on the new {productname}Â Server, you need to mirror the products from SCC. 



== Synchronize with SUSE Customer Center 

This section covers synchronizing with SCC from the {webui} and adding your first client channel.

[[proc-admin-organization-credentials]]
.Procedure: Entering Organization Credentials
. In the {susemgr} {webui}, select menu:Admin[Setup Wizard].
. From the [guimenu]``Setup Wizard`` page select the btn:[Organization Credentials] tab.
. Click btn:[Add a new credential].
. In the dialog, enter [guimenu]``Username`` and [guimenu]``Password``, and confirm with btn:[Save].

When the credentials are confirmed with a check-mark icon, proceed with <<proc-quickstart-first-channel-sync>>.

[[proc-quickstart-first-channel-sync]]
.Procedure: Synchronizing with {scc}
. In the {webui}, navigate to menu:Admin[Setup Wizard].
. From the [guimenu]``Setup Wizard`` page select the btn:[SUSE Products] tab.
    If you previously registered with {scc} a list of products will populate the table.
    This operation could take up to a few minutes.
    You can monitor the progress of the operation in section on the right ``Refresh the product catalog from SUSE Customer Center``.
    The table of products lists architecture, channels, and status information.
    For more information, see xref:reference:admin/setup-wizard.adoc[Wizard].
+
image::admin_suse_products.png[scaledwidth=80%]
. Use ``Filter by product description`` and ``Filter by architecture`` to filter the liste of displayed products.
    If your {sle} client is based on [systemitem]``x86_64`` architecture scroll down the page and select the check box for this channel now.
+

* Add channels to {productname} by selecting the check box to the left of each channel.
    Click the arrow symbol to the left of the description to unfold a product and list available modules.
* Click btn:[Add Products] to start product synchronization.

After adding the channel, {productname} will schedule the channel to be synchronized.
This can take a long time as {productname} will copy channel software sources from the {suse} repositories located at {scc} to local [path]``/var/spacewalk/`` directory of your server.

When the channel is fully synchronised, the bootstrap repository will be automatically created.
The bootstrap repository is necessary for the succesful bootstrapping of creation of the  activation key will be assciated with
the clients can be bootstrapped following the steps This completes {productname} installation and configuration, with channel preparation for the client bootstrapping.

When the channel synchronization process is complete, you can continue with client registration.
For more instructions, see xref:client-configuration:registration-overview.adoc[].



== Entering the container for management

To get to a shell in the pod run:
----
sudo mgrctl exec -ti bash
----


== Basic commands for working with {micro} {microversion}


=== Transactional commands

To Install a package::
+

----
transactional-update pkg install
reboot
----

To Remove a package::
+

----
transactional-update pkg remove
reboot
----

To enter an interactive shell to work with zypper::
Make the adjustments you like: 
+

----
transactional-update shell
zypper install <package_name>
----
+

Exit the shell and reboot into the new snapshot:
+

----
exit
reboot
----

=== Working with snapshots

To list all snapshots::
+

----
snapper list
----

To list the difference between snapshots::
+

----
snapper diff 2..3
----

To compare snapshots::
+

----
snapper status 2..3
----

To rollback to a snapshot::
+

----
snapper rollback 2
----

To delete a in-active or unmounted snapshot::
+

----
snapper delete 2
----

To delete a mounted snapshot::
First set another snapshot as default
+

----
snapper modify 2 --default
----
+

Then unmount the snapshot to be deleted and remove it
+

----
snapper umount 3
snapper delete 3
----