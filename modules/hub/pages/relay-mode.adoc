[[relay-mode-example]]
= Relay mode


The Relay authentication mode is a convenient method where the same credentials used to login into the Hub API are used to login into the APIs of the peripheral Servers the user wants to work with. It is thus assumed that the credentials are valid in each Server and correspond to a user with appropriate permissions.
After login, it is still necessary to to call `attachToServers` method to define the subset of Servers that will be targeted in subsequent calls.

In the following example:

* Credentials for the hub are passed to the `loginWithAuthRelayMode` method, a session key for the HUB API is returned (`hubKey`)
* Using the session key from the previous step, {productname} Server IDs are obtained for all the peripheral servers attached to the Hub via the `hub.listServerIds` method
* Call to `attachToServers` is made, same credentials as used for logging into hub will be further passed against each of the Servers' XMLRPC API endpoints for authentication
* A `multicast` call is performed on a set of Servers(`serverIds` contains all IDs of the servers to target). Behind the scenes, `system.list_system` is called on each {productname} server's XMLRPC API
* Hub will aggregate the results and return the response in form of a `map`. This map has two entries:
- `Successful`: contains a list of responses for those clients where the call was successful.
- `Failed`: contains a list of responses for those clients where the call failed.

[NOTE]
====
If you want to call a method on just one {productname} Server, then Hub API also provides a more convenient `unicast` namespace. In this case, the response will be a single value and not a map, just as if the user called that {productname} server's API directly.
====

* User logs out



[source,python]
----
#!/usr/bin/python
import xmlrpclib


HUB_URL = "http://localhost:8888/hub/rpc/api"
HUB_LOGIN = "admin"
HUB_PASSWORD = "admin"

client = xmlrpclib.Server(HUB_URL, verbose=0)

hubKey = client.hub.loginWithAuthRelayMode(HUB_LOGIN, HUB_PASSWORD)

#Get the server Ids
serverIds = client.hub.listServerIds(hubKey)

#authenticate those servers(same credentials will be used as of hub to authenticate)
client.hub.attachToServers(hubKey, serverIds)

# perform the needed operation
systemsPerServer = client.multicast.system.list_systems(hubKey, serverIds)
successfulResponses = systemsPerServer["Successful"]["Responses"]
failedResponses = systemsPerServer["Failed"]["Responses"]

for system in successfulResponses:
  print (system)

#logout
client.auth.logout(hubKey)
----
