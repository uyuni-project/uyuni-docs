[[retail-formulas]]
= Introduction to Retail Formulas
:revdate: 2024-07-18
:page-revdate: {revdate}

Formulas are pre-written Salt states, that are used to configure your {productname} {smr} installation.

You can use the {productname} {webui} to apply common {productname} formulas.
For the most commonly used formulas, see xref:specialized-guides:salt/salt-formulas-intro.adoc[].

All formulas must be accurately configured for your {productname} {smr} installation to function correctly.


== Branch Server Formulas

The formulas you need to configure on a branch server depend on whether you are using a legacy {productname} Proxy 4.3 branch server, or a containerized {productname} 5.1 branch server.

Branch servers are configured using formulas. Formulas can be configured using {productname} {webui}, or the {productname} XMLRPC API.

=== Legacy Branch Server ({productname} Proxy 4.3)

To fully configure a {productname} Proxy 4.3, some formulas need to be enabled and configured on the branch server.

The following formulas are required:

* Branch network formula, see xref:specialized-guides:salt/salt-formula-branchnetwork.adoc[]
* PXE formula, see xref:specialized-guides:salt/salt-formula-pxe.adoc[]
* TFTP formula, see xref:specialized-guides:salt/salt-formula-tftpd.adoc[]
* Image synchronization formula, see xref:specialized-guides:salt/salt-formula-imagesync.adoc[]

The following formulas are optional:

* BIND formula, see xref:specialized-guides:salt/salt-formula-bind.adoc[]
* DHCPD formula, see xref:specialized-guides:salt/salt-formula-dhcpd.adoc[]

=== Containerized Branch Server ({productname} 5.1)

On a {productname} 5.1 Proxy, PXE, TFTP and image synchronization are provided as containerized services, which do not use formulas.

You can use other formulas on the salt-managed Proxy container host if you need them:

* Branch network formula, see xref:specialized-guides:salt/salt-formula-branchnetwork.adoc[]
* BIND formula, see xref:specialized-guides:salt/salt-formula-bind.adoc[]
* DHCPD formula, see xref:specialized-guides:salt/salt-formula-dhcpd.adoc[]

The BIND and DHCPD formulas use container images.

[NOTE]
====
For air-gapped environments, the container images for BIND and DHCPD formulas must be manually pulled from a connected system, saved to a TAR archive, transferred to the air-gapped server, and then loaded. Refer to the main air-gapped deployment documentation for detailed steps on this process, ensuring you use the correct image paths and tags for the BIND and DHCPD formulas.
====

[IMPORTANT]
====
Badly configured formulas can result in the branch server failing to work as expected.
Due to the generic nature of formulas it is difficult to do overall validation.
We recommend that you configure the branch server using the {productname} {smr} command line utilities, and use individual formula settings for further tuning if required.
For more information, see xref:retail:retail-install-setup.adoc[].
====

[WARNING]
====
If a formula uses the same name as an existing Salt state, the two names will collide.
This could result in the formula being used instead of the state.
Always check the names of states and formulas to avoid name collisions.
====

When you have made changes to your formula, ensure you apply the highstate.
The highstate propagates your changes to the appropriate services.



== Partitioning and Image Deployment Formula

Use the {saltboot} formula to specify disk partitioning, and to select which image should be deployed.
For more information about the {saltboot} formula, see xref:specialized-guides:salt/salt-formula-saltboot.adoc[].
