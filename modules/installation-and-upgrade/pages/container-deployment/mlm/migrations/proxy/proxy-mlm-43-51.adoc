= Proxy Migration from 4.3 to 5.1
:revdate: 2025-10-19
:page-revdate: {revdate}
ifeval::[{uyuni-content} == true]

:noindex:
endif::[]

== Requirements and considerations

* To migrate a SUSE Manager 4.3 Proxy to {productname} {productnumber}, you require a new machine with {sl-micro} {microversion} or {sles} {bci-mlm} and [literal]``mgrpxy`` installed.

* An in-place migration from SUSE Manager 4.3 to {productnumber} is not supported, regardless of whether the chosen host operating system is {sl-micro} {microversion} or {sles} {bci-mlm}.

* Before migrating from SUSE Manager 4.3 to {productnumber}, any existing traditional clients including the traditional proxies must be migrated to {salt}.
For more information about migrating traditional {productname} 4.3 clients to {salt} clients, see https://documentation.suse.com/suma/4.3/en/suse-manager/client-configuration/contact-methods-migrate-traditional.html.

* Traditional contact protocol is no longer supported in {productname} 5.0 and later.

* Before migrating a SUSE Manager 4.3 Proxy to {productname} {productnumber}, the SUSE Manager 4.3 Server
needs to be migrated first, see xref:installation-and-upgrade:container-deployment/mlm/migrations/server/server-mlm-43-51.adoc[].


== Introduction

In {productname} 4.3, the proxy can be deployed using three different methods:

* RPM based
* containerized running on Podman
* containerized running on k3s

In {productname} {productnumber}, RPM based support was removed, and only the containerized version running with podman or k3s is supported. 
Furthermore, the management of the containerized proxy running with Podman was re-designed and made simpler with the [command]``mgrpxy`` tool.

== Migration workflow overview

//TODO add workflow picture
== Backup existing {productproxy} data


== Deploy a new {productname} {productnumber} proxy

An in-place migration from {productname} 4.3 to {productnumber} will change the host operating system from {sles} 15 SP4 to {sl-micro} {microversion} or {sles} {bci-mlm}.


== Migrate clients to the new proxy

[IMPORTANT]
====
Before migrating the clients, ensure that the new {productname} {productnumber} Proxy is already deployed and fully functional.
====

[IMPORTANT]
====
The traditional contact protocol is no longer supported in {productname} 5.0 and later.
Before migrating from {productname} 4.3 to {productnumber}, any existing traditional clients including the traditional proxies must be migrated to {salt}.

For more information about migrating to {salt} clients, see https://documentation.suse.com/suma/4.3/en/suse-manager/client-configuration/contact-methods-migrate-traditional.html
====

.Procedure: Migrating clients from the old to the new proxy
[role=procedure]
____
. Log in to the {productname} Server {webui}.

. From the left navigation, select menu:Systems[Systems List].

. Navigate to the old 4.3 proxy page, and click the [guimenu]``Proxy`` tab.

. Select all systems to "SSM".

. From the left navigation, select menu:Systems[System Set Manager].

. Select the sub-menu menu:Misc[Proxy].

. From the drop-down select the new proxy to migrate to.

. Click btn:[Change Proxy].

____

All selected clients will now be migrated to the new proxy.
You can check the schedule progress to verify if all clients were successfully migrated.

After a few minutes, the clients will start to show the new connection path.
When all clients have the connection path under the new proxy, the old SUSE Manager 4.3 Proxy system is not needed anymore and can be removed.


== TFTP files synchronization

Containerized proxies do not use tftpsync mechanism to transfer tftproot files.
Instead these files are transparently downloaded and cached on demand.

To prevent false positive errors during [command]``cobbler sync`` run, migrated 4.3 proxies need to be removed from tftpsync mechanism.

If you previously configured a 4.3 proxy to receive TFTP files, one of the following configuration option is required:

[NOTE]
====
To get to a shell inside the container, run on the container host:
----
mgrctl term
----
====

* In the {productname} {productnumber} server container, run [command]``configure-tftpsync.sh`` with the list of remaining 4.3 proxies as arguments.
If no 4.3 proxies remain, run [command]``configure-tftpsync.sh`` with no arguments.

* In the {productname} {productnumber} server container, manually remove the relevant proxy from the [option]``proxies`` setting in the [path]``/etc/cobbler/settings.yaml`` file.
If there are no 4.3 proxies remaining, then manually remove the [option]``proxies`` list completely.
