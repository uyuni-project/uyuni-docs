[[proxy-conversion-from-client-mlm]]
= Proxy conversion from client

== Introduction

This chapter describes how {productname} proxy can be registered with {productname} server.
The main principle consists of using a functionality within {webui} which converts an already onboarded client to a proxy.

The client which is a candidate for conversion to proxy must adhere to the following pre-requisites:

* it must already be onboarded
* it is reachable
* it has access to client tools 

ifeval::[{mlm-content} == true]
* it is one of the following systems:
** {sles} 15 SP7
** {sl-micro} 6.1
endif::[]


== Convert the client to {productname} Proxy

The process of conversion is done entirely from the {webui} for already registered clients. 
For more information about client onboarding, see xref:client-configuration:registration-overview.adoc[].

The following two procedures describe the client conversion to a proxy.
Either procedure can be used, and will achieve the same outcome.

.Procedure: Converting client to {productname} Proxy using dedicated button
. For the client chosen to be converted to proxy, go to its [literal]``Overview`` page.
. Click button btn:[Convert to Proxy].
. Wait for the conversion to complete.
. Confirm that the conversion has been successful by locating a new tab [literal]``Proxy`` on the [literal]``Overview`` page.
. Confirm there are two tabs within [literal]``Proxy``, [literal]``Clients`` and [literal]``Configuration``.

Proceed with the steps to <<configure-proxy>>.

.Procedure: Converting client to {productname} Proxy by changing client's properties
. For the client chosen to be converted to proxy, go to its [literal]``Properties`` page.
. Locate the section [literal]``Add-on System Types``.
. Check the option [literal]``Proxy``.
. Click button btn:[Update Properties].
. Follow the displayed note and apply highstate to complete the conversion.
. Confirm that the conversion has been successful by locating a new tab [literal]``Proxy`` on the [literal]``Overview`` page.
. Confirm there are two tabs within [literal]``Proxy``, [literal]``Clients`` and [literal]``Configuration``.

Proceed with the steps to <<configure-proxy>>.


[[configure-proxy]]
== Configure the Proxy

Once the client had been succesfully converted to proxy, it needs to be configured.

. In the {webui}, navigate to menu:Proxy[Configuration] and fill the required data:
. In the [guimenu]``Parent FQDN`` field type fully qualified domain name for the parent.
. In the [guimenu]``Proxy SSH port`` field type SSH port on which SSH service is listening on {productname} Proxy. It is recommended to keep default 8022.
. In the [guimenu]``Max Squid cache size [MB]`` field type maximal allowed size for Squid cache.
. In the [guimenu]``Proxy admin email`` field type the admin's email.
. In the section [literal]``Certificates`` select one of two options: [literal]``Keep`` or [literal]``Replace``.
.. Select [literal]``Keep`` if an existing certificate should be used.
.. Select [literal]``Replace`` if the new server certificate should be generated for {productname} proxy.
(CAN WE KEEP THIS?) You can consider generated certificates as {productname} builtin (self-signed) certificates.
+
Depending on the choice then provide either path to signing CA certificate to generate a new certificate or path to an existing certificate and its key to be used as proxy certificate.
+
The CA certificates generated by the server are stored in the [path]``/var/lib/containers/storage/volumes/root/_data/ssl-build`` directory.
+
For more information about existing or custom certificates and the concept of corporate and intermediate certificates, see  xref:administration:ssl-certs-imported.adoc[].

. In the section [literal]``Source`` select one of two options: [literal]``Registry`` or [literal]``RPM``.
.. For disconnected environments, when the proxy has no access to the registry, select option [literal]``RPM``. (FIND OUT: Is the RPM then provided via GUI?)
.. If the proxy has access to the registry, either option can be selected.  
. In case [literal]``Registry`` is selected, select one of two options: [literal]``Simple`` or [literal]``Advanced``.
.. If the option selected is [literal]``Simple`` enter the value in [literal]``Registry URL``.
.. If the option selected is [litaral]``Advanced`` additional section of the form opens.
  Fill in all fields with the values of the relevant URls and Tags.
. Once all fields are filled in, click btn:[Apply] to apply the changes.


[WARNING]
====
In case of the proxy chain, if the option [literal]``Registry`` is selected as source for the child proxy, the root proxy must have access to the same registry too.
====

