[[deploy-suma-server]]
= Deploy {productname} {productnumber} Server
ifeval::[{uyuni-content} == true]
:noindex:
endif::[]

This guide shows you how to install and configure a {productname} {productnumber} container on {micro} {microversion}.


== Hardware Requirements for {productname}

This table shows the software and hardware requirements for deploying {productname} Server on your bare metal machine.
For the purposes of this guide your machine should have 16GB of RAM, and at least 200 GB of disk space.

[cols="1,1", options="header"]
.Software and Hardware Requirements
|===
| Software and Hardware  | Recommended
| Operating System:      | {micro} {microversion}
| CPU:                   | 4 64-bit CPU cores
| RAM:                   | 16 GB
|                        |
|                        | 
| Disk Space:            | 200 GB
| Channel Requirements   | 50 GB per SUSE or openSUSE product
                          
                           360 GB per Red Hat product
| Swap space:            | 3 GB
|===

.Supported operating system for the Server Container Host
[NOTE]
====
The supported operating system for the container host is {micro} {microversion}.

Container host:: A container host is a server equipped with a container engine like Podman, which lets it manage and deploy containers. These containers hold applications and their essential parts, such as libraries, but not a full operating system, making them lightweight. This setup ensures applications run the same way in different environments. The container host supplies the necessary resources such as CPU, memory, and storage for these containers.
====

[IMPORTANT]
====
Server deployment mandates the use of a fully qualified domain name (FQDN). In the absence of automatic DNS provision of an FQDN by your router or network, the deployment process will not proceed successfully. An FQDN typically follows the format <host>.<domain>.com.

For instance:

* suma.example.com
* suma.fritz.box
* suma.container.lab

For additional details, refer to the section on network requirements in the Installation and Upgrade Guide, available at xref:installation-and-upgrade:network-requirements.adoc[].
====


== {micro} {microversion} Installation

=== Acquire the Installation Media

.Procedure: Download the Installation Media
. Locate the {micro} {microversion} installation media at https://www.suse.com/download/sle-micro/.
. You will need an account with {scc} and must be logged in to download the ISO.
. Download the following file: [filename]``SLE-Micro-5.5-DVD-x86_64-GM-Media1.iso`` 
. Prepare the installation media for use.

For detailed documentation on preparing your machines OS (virtual or physical), see link:https://documentation.suse.com/sle-micro/5.5/html/SLE-Micro-all/book-deployment-slemicro.html[{micro} {microversion} Deployment Guide].


=== {micro} {microversion} Installation

.Procedure: {micro} {microversion} Installation 
. Use the arrow keys to select [systemitem]``Installation``.

. Adjust Keyboard and language. Click the [systemitem]``checkbox`` to accept the License Agreement.

. Click [systemitem]``Next`` to continue.

. Select your registration method. For this example we will register the server with {scc}.
+

.{productname} as an extension
[NOTE]
====
The {productname} {productnumber} container is installed as an extension. Therefore, in addition to acquiring {scc} registration keys for {micro} {microversion}, you will also need {scc} registration codes for the following extensions:

* {productname} {productnumber} Server
* {productname} {productnumber} Proxy
* Retail Branch Server
====

. Enter your {scc} Email address. 

. Enter your registration code for {micro} {microversion}.

. Click [systemitem]``Next`` to continue.

. On the [systemitem]``Extension and Module Selection`` page uncheck the **Hide Development Versions** checkbox. 

. Select the {productname} {productnumber} Server extension [systemitem]``Checkbox``.

. Click [systemitem]``Next`` to continue.

. Enter your {productname} {productnumber} Server extension registration code.

. Click btn:[Next] to continue.

. On the [systemitem]``NTP Configuration`` page click btn:[Next].

. On the [systemitem]``Authentication for the System`` page enter a password for the root user. Click btn:[Next].

. On the [systemitem]``Installation Settings`` page click btn:[Install].

This concludes installation of {micro} {microversion} and {productname} {productnumber} as an extension.



=== Update the system
. Login as *root*.

. Run **transactional-update**:
+

[source, shell]
----
transactional-update
----

. Reboot the system.

. Login as root.

. Enter the transactional shell:
+

[source, shell]
----
transactional-update shell
----

. Install the container utilities:
+

[source, shell]
----
transactional-update pkg install mgradm mgrctl mgradm-bash-completion mgrctl-bash-completion
----
+

. Reboot the system.



== Deploy with mgradm

.Procedure: Deploy {productname} {productnumber} with mgradm
. From the terminal run the following command replacing <suma.example.com> with your fully qualified domain name.
+

[source, shell]
----
mgradm install podman <suma.example.com>
----

. Enter a certificate and administrator account password when prompted. 
+

[NOTE]
====
The administrator account password must be at least 5 characters and less
than 48 characters in length.
====
+

. Press btn:[Enter].

. Enter the email address of the administration account. Press btn:[Enter].

. Wait for deployment to complete.

. Open a browser and proceed to your servers FQDN, or IP address.

In this guide you learned how to deploy {productname} {productnumber} Server as a container.



== Synchronize with SUSE Customer Center 

This section covers synchronizing with SCC from the {webui} and adding your first client channel.

[[proc-admin-organization-credentials]]
.Procedure: Entering Organization Credentials
. In the {susemgr} {webui}, select menu:Admin[Setup Wizard].
. From the [guimenu]``Setup Wizard`` page select the btn:[Organization Credentials] tab.
. Click btn:[Add a new credential].
. In the dialog, enter [guimenu]``Username`` and [guimenu]``Password``, and confirm with btn:[Save].

When the credentials are confirmed with a green check-mark icon, proceed with <<proc-quickstart-first-channel-sync>>.

[[proc-quickstart-first-channel-sync]]
.Procedure: Synchronizing with {scc}
. In the {webui}, navigate to menu:Admin[Setup Wizard].
. From the [guimenu]``Setup Wizard`` page select the btn:[SUSE Products] tab.
    If you previously registered with {scc} a list of products will populate the table.
    This operation could take up to a few minutes.
    You can monitor the progress of the operation in section on the right ``Refresh the product catalog from SUSE Customer Center``.
    The table of products lists architecture, channels, and status information.
    For more information, see xref:reference:admin/setup-wizard.adoc[Wizard].
+
image::admin_suse_products.png[scaledwidth=80%]
. Use ``Filter by product description`` and ``Filter by architecture`` to filter the list of displayed products.
    If your {sle} client is based on [systemitem]``x86_64`` architecture scroll down the page and select the check box for this channel now.
+

* Add channels to {productname} by selecting the check box to the left of each channel.
    Click the arrow symbol to the left of the description to unfold a product and list available modules.
* Click btn:[Add Products] at the top of the page to start product synchronization.

After adding the channel, {productname} will schedule the channel to be synchronized.
This can take a long time as {productname} will copy channel software sources from the {suse} repositories located at {scc} to the local [path]``/var/lib/containers/storage/volumes/var-spacewalk/`` directory of your server.

When the channel is fully synchronized, the bootstrap repository for it will be automatically created.
This is necessary for the successful bootstrapping of a client. This completes the {productname} installation and configuration, with channel preparations for bootstrapping clients.

When the channel synchronization process is complete, you can continue with the client registration.
For more instructions, see xref:client-configuration:registration-overview.adoc[].



== Entering the container for management

To get to a shell inside the container, run the following on the host:
----
mgrctl term
----



[[installation-server-container]]
= Deploy on {micro} {microversion}
ifeval::[{uyuni-content} == true]
:noindex:
endif::[]

In this section, you will gain expertise in setting up and deploying a containerized {productname} {productnumber} Server.
This process installs {micro}, and then interacts with the container through the container utilities [command]``mgradm`` and [command]``mgrctl``.



== Container Host General Requirements

For general requirements, see xref:installation-and-upgrade:general-requirements.adoc[].

A {micro} or {sles} server should be installed from installation media.
This procedure is described in xref:installation-and-upgrade:container-deployment/suma/sle-micro-deployment.adoc#installation-server-container-micro[].




[[installation-server-containers-requirements]]
== Container Host Requirements

For CPU, RAM, and storage requirements, see xref:installation-and-upgrade:hardware-requirements.adoc[].


[IMPORTANT]
====
To guarantee that clients can resolve the {productname} {productnumber} domain name, both the container server and host machines must be linked to a functional DNS server.
Additionally, it is essential to ensure correct configuration of reverse lookups.
====



[[installation-server-container-micro]]
== {micro} {microversion} Installation

Get a copy of the {micro} {microversion} installation media.
You can begin the installation on either a virtual machine or on a physical server.


.Procedure: {micro} {microversion} installation
. Begin the installation from the installation media.

. Adjust keyboard and language.
  Click the [systemitem]``checkbox`` to accept the license agreement.

. Click btn:[Next] to continue.

. Select your registration method.
  For this example, we will register the server with the {scc}.

. Enter your {scc} e-mail address.

. Enter your registration code for {micro} {microversion}.
+

.Base operating system for {productname} {productnumber} containerized Server
[NOTE]
====
For {productname} 5.0, the base operating system of the container is {sles} {bci-suma}.
You can find these keys in your {scc} account.
====

. If wanted activate online repositories.

. Click btn:[Next] to continue.

. Select the {productname} {productnumber} Server extension [systemitem]``Checkbox``.

. Click [systemitem]``Next`` to continue.

. Enter your {productname} {productnumber} Server extension registration code.
+

.{productname} as an extension
[NOTE]
====
{productname} {productnumber} is installed as an extension.
Therefore, in addition to acquiring {scc} registration keys for the base Server, you will also need {scc} registration codes for the following extensions:

* {productname} {productnumber} Server
* {productname} {productnumber} Proxy
* Retail Branch Server

====
+

. Click [systemitem]``Next`` to continue.

. Enter or accept default [systemitem]``NTP Server``.

. Click [systemitem]``Next`` to continue.

. Add the [systemitem]``root user`` password twice to confirm.

. Click [systemitem]``Next`` to continue.

. Adjust [systemitem]``Installation Settings`` as required.

. Click [systemitem]``Next`` to continue.

This concludes the installation of {micro} {microversion}.



== Update the Container Host

When the installation completes, update the container host system.

.Procedure: Update the container host and install the container utilities

. Log in at the prompt as *root*.

. Run **transactional-update**:
+

[source, shell]
----
transactional-update
----

. Reboot the system.

. Log in as root.

. Install the container utilities:
+

[source, shell]
----
transactional-update pkg install mgradm mgrctl mgradm-bash-completion mgrctl-bash-completion
----
+

. Reboot the system.


== Deploy as container on {micro} {microversion}


=== Basic and Advanced Deployment with mgradm

.Procedure: Basic deployment of a {productname} {productnumber} container with Podman
. From the terminal of the container host, run the following command as the root user.
  Entering your server's FQDN is optional.
  Leave blank for a default setup.
+

[source, shell]
----
mgradm install podman <FQDN>
----
+

[IMPORTANT]
====
You must deploy the container as sudo or root.
The following error will be displayed on the terminal if you miss this step.

// This is not shell code
----
INF Setting up uyuni network
9:58AM INF Enabling system service
9:58AM FTL Failed to open /etc/systemd/system/uyuni-server.service for writing error="open /etc/systemd/system/uyuni-server.service: permission denied"
----
====
+

. Enter a database and certificate password when prompted.
  Press btn:[Enter].

. Enter a certificate and administrator account password when prompted.
+

[NOTE]
====
The administrator account password must be at least 5 characters and less than 48 characters in length.
====
+

. Press btn:[Enter].

. Wait for deployment to complete.

. Open a browser and proceed to your server's FQDN, or IP address.

In this section you learned the basic method for deploying a {productname} {productnumber} Server container.


.Procedure: Advanced deployment of a {productname} {productnumber} container using a custom configuration file
. Prepare a configuration file named [filename]``mgradm.yaml`` similar to the following example:
+

[source, yaml]
----
# Database password. Randomly generated by default
db:
  password: MySuperSecretDBPass

# Password for the CA certificate
ssl:
  password: MySuperSecretSSLPassword

# Your SUSE Customer Center credentials
scc:
  user: ccUsername
  password: ccPassword

# Organization name
organization: YourOrganization

# Email address sending the notifications
emailFrom: notifications@example.com

# Administrators account details
admin:
  password: MySuperSecretAdminPass
  login: LoginName
  firstName: Admin
  lastName: Admin
  email: email@example.com
----
+
[IMPORTANT]
====
For security, **using command line parameters to specify passwords should be avoided**: use a configuration file with proper permissions instead.
====
+

. From the terminal, run the following command as the root user.
  Entering your server's FQDN is optional.
+

[source, shell]
----
mgradm -c mgradm.yaml install podman <FQDN>
----
+

[IMPORTANT]
====
You must deploy the container as sudo or root. The following error will be displayed at the terminal if you miss this step.

// This is not shell code
----
INF Setting up uyuni network
9:58AM INF Enabling system service
9:58AM FTL Failed to open /etc/systemd/system/uyuni-server.service for writing error="open /etc/systemd/system/uyuni-server.service: permission denied"
----
====

. Wait for deployment to complete.

. Open a browser and proceed to your server's FQDN or IP address.

In this section you learned how to deploy the {productname} Server container.



=== Persistent Volumes

[NOTE]
====
If you are just testing out {productname} you do not need to specify these volumes.
[command]``mgradm`` will setup the correct volumes by default.

Specifying volume locations will generally be used for larger production deployments.
====

Many users will want to specify locations for their persistent volumes.



By default, [command]``Podman`` stores its volumes in [path]``/var/lib/containers/storage/volumes/``.

You can provide custom storage for the volumes by mounting disks on this path or the expected volume path inside it such as: [path]``/var/lib/containers/storage/volumes/var-spacewalk``.
This is especially important for the database and package mirrors.

For a list of all persistent volumes in the container see, xref:installation-and-upgrade:container-management/persistent-container-volumes.adoc[].

