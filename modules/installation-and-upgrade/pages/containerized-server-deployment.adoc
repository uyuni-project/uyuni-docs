
= Containerized {productname} server deployment
// remove this attribute at publishing time
:uyuni-content: true

The process of installing {productname} server was changed in version {productnumber}. 
{productname} is now deployed as a container.


ifeval::[{uyuni-content} == true]
== Requirements for deployment

You should already have your own server. This should be either {tumbleweed} or {opensuse} {opensuse-version}

* A server (This can be physical, or a virtual machine)
* Podman
* Uyuni container utilities


== Installing Podman on openSUSE Leap {opensuse-version} and {tumbleweed}

To install Podman on either {opensuse} {opensuse-version}, follow these steps:

. Open a terminal window.

. Update the package manager's repository information to ensure you have the latest package information:
+

[source,shell]
----
sudo zypper refresh
----

. Install Podman by running the following command:
+

[source,shell]
----
sudo zypper -y install podman
----

. Zypper will download and install Podman along with its dependencies.

. Once the installation is complete, verify that Podman is installed by running:

[source,shell]
----
podman --version
----

This command should display the installed version of Podman.
You should now have Podman successfully installed on your openSUSE Leap 15.5 system, and you can start using it to manage containers on your system.



== Installing Uyuni tools for use with containers

=== {opensuse} {opensuse-version}

. Add the following repository to your {opensuse} {opensuse-version} server and accept the key.
+

----
sudo zypper ar https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Master:/ContainerUtils/openSUSE_Leap_15.5/systemsmanagement:Uyuni:Master:ContainerUtils.repo
----

. Install tools:
+

----
sudo zypper in mgradm mgrctl mgradm-bash-completion mgrctl-bash-completion netavark
----



=== {opensuse} {tumbleweed}

. Add the following repository to your {opensuse} {tumbleweed} server and accept the key..
+

----
sudo zypper ar https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Master:/ContainerUtils/openSUSE_Tumbleweed/systemsmanagement:Uyuni:Master:ContainerUtils.repo
----

. Install tools:
+

----
sudo zypper in mgradm mgrctl mgradm-bash-completion mgrctl-bash-completion netavark
----


== Installing Uyuni with the mgradm tool

The {productname} is deployed as a container using the **mgradm** tool.
There are two paths for deployment:

. Running the **mgradm** command will prompt for basic server variables during the deployment. 
. You can also create a custom **mgradm.yaml** file to use for deployment.

[NOTE]
====
 **mgradm** will prompt for basic variables if are not provided using command line parameters or a configuration file. 
 For security, **using command line parameters to specify passwords should be avoided**: use the configuration file with proper permissions instead.
====



== Managing containers with the mgrctl tool

mgrctl tool for using the container


[[persistant-volume-list]]
== List of peristent storage volumes



Changes in a container are probably not consistent.
containers can be stopped no problem
changes outside volumes will be lost

[source, yaml]
----
// This map should match the volumes mapping from the container definition in both
// the helm chart and the systemctl services definitions
var VOLUMES = map[string]string{
	"var-cobbler":         "/var/lib/cobbler",
	"var-salt":            "/var/lib/salt",
	"var-pgsql":           "/var/lib/pgsql",
	"var-cache":           "/var/cache",
	"var-spacewalk":       "/var/spacewalk",
	"var-log":             "/var/log",
	"srv-salt":            "/srv/salt",
	"srv-www":             "/srv/www/",
	"srv-tftpboot":        "/srv/tftpboot",
	"srv-formulametadata": "/srv/formula_metadata",
	"srv-pillar":          "/srv/pillar",
	"srv-susemanager":     "/srv/susemanager",
	"srv-spacewalk":       "/srv/spacewalk",
	"root":                "/root",
	"etc-apache2":         "/etc/apache2",
	"etc-rhn":             "/etc/rhn",
	"etc-systemd-multi":   "/etc/systemd/system/multi-user.target.wants",
	"etc-systemd-sockets": "/etc/systemd/system/sockets.target.wants",
	"etc-salt":            "/etc/salt",
	"etc-tomcat":          "/etc/tomcat",
	"etc-cobbler":         "/etc/cobbler",
	"etc-sysconfig":       "/etc/sysconfig",
	"etc-tls":             "/etc/pki/tls",
	"etc-postfix":         "/etc/postfix",
	"ca-cert":             "/etc/pki/trust/anchors",
}
----
endif::[]