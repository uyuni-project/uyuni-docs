[[install-vm]]
= Install {productname} in a Virtual Machine Environment Using {productname} VM Image



This chapter provides procedures for deploying Kernel Virtual Machine (KVM) or VMware images.

You will find the images for {productname} {productnumber} in various formats.
They include {sles} {sles-version} {sp-base} as the underlying operating system and the {productname} software current at the time of build.
Download the appropriate {productname} image for your environment from https://download.suse.com/.

[NOTE]
====
Using a tool such as [systemitem]``Ignition`` to set up a [systemitem]``root`` password is optional now.
For more information about [systemitem]``Ignition``, see xref:installation-and-upgrade:install-ignition.adoc[].
====



[[quickstart.sect.kvm.settings]]
== Virtual Machine Manager Settings

This section provides the required Kernel Virtual Machine (KVM) settings for {productname}.
KVM combined with Virtual Machine Manager (_virt-manager_) will be used as a sandbox for this installation.



[NOTE]
====
This table specifies the minimum requirements.
These are suitable for a quick test installation, such as a server with one client.
If you want to use a production environment, review the requirements listed in xref:installation-and-upgrade:hardware-requirements.adoc[].
====


[cols="1,1", options="header"]
|===
2+<| Virtual machine settings overview
| Installation Method | Import Existing Disk Image
| OS:                 | SUSE Linux Enterprise 15 SP4
| Memory:             | 16 GB
| CPU's:              | 4
| Virtual Disks:      |
| VirtIO Disk 1       | SUSE-Manager-Server.x86_64-4.3.10-KVM.qcow2
| VirtIO Disk 2       | 101 GB for [path]``/var/spacewalk``
| VirtIO Disk 3       | 50 GB for [path]``/var/lib/pgsql``
| VirtIO Disk 4       | 4 GB for swap
| Name:               | suse-manager-test-setup
| Network:            | Bridge _br0_
|===

[NOTE]
====
For more information on {sle} Virtualization, see https://documentation.suse.com/sles/15-SP4/html/SLES-all/book-virtualization.html.
====



[[sumavm.kvm.settings]]
== {productname} Virtual Machine Creation - KVM

Create a virtual machine with three additional virtual disks required for the {productname} storage partitions.

.Procedure: Creating the VM and Additional Partitions with  [command]``virt-manager``
. In [command]``virt-manager``, open menu:File[New Virtual Machine].
. In the [guimenu]``Create a new virtual machine`` dialog, select [guimenu]``Import existing disk image`` and confirm with btn:[Forward].
. Enter the filename of the downloaded {productname} KVM image and set [literal]``SUSE Linux Enterprise 15 SP4`` as the operating system.
  Confirm with btn:[Forward].
. Configure RAM and number of CPUs (at least 16 GB RAM and 4 CPUs).
  Confirm with btn:[Forward].
. Set the name of your VM and select the [guimenu]``Customize configuration before install`` check box.
. With the [guimenu]``Network selection`` drop-down menu select the configured bridge device.
. Confirm with btn:[Finish].
. In the overview dashboard, at the bottom of the left navigation bar, click btn:[Add Hardware] to create additional virtual disks with the following specifications.
  These disks will be partitioned and mounted in <<proc.sumavm.susemgr.prep>>.
+

[NOTE]
====
Storage size values are the absolute minimum—only suitable for a small test or demo installation.
Especially [path]``/var/spacewalk/`` may quickly need more space.
Also consider to create a separate partition for [path]``/srv`` where Kiwi images are stored.
====
+

[cols="1,1,1", options="header"]
|===
| VirtIO Storage Disks | Name      | Sizing
| VirtIO Disk 2        | spacewalk | 500{nbsp}GB
| VirtIO Disk 3        | pgsql     | 100{nbsp}GB
| VirtIO Disk 4        | swap      | 4{nbsp}GB
|===
+

. Click btn:[Begin Installation] to boot the new VM from the {productname} image.
. At the JeOS Firstboot screen select btn:[Start] to continue and check the following configuration options (keyboard layout, license agreement, time zone, password for root).

. When installation completes, log in as root.

. Proceed with xref:installation-and-upgrade:install-vm.adoc#minimal.susemgr.prep[].



// FIXME: check the following and esp. replace with firstboot (see 5.0 docs)
== {productname} Virtual Machine Creation - VMware

This sections describes VMware configurations, focusing on the creation of an extra virtual disk essential for the {productname} storage partition within VMware environments.

.Procedure: Creating the VMware Virtual Machine

. Download {productname} Server [filename]``.vmdk`` file.
  Then transfer a copy to your VMware storage.

. Make a copy of uploaded [filename]``.vmdk`` file using VMware web interface.
  This will convert provided [filename]``.vmdk`` file to the format suitable for vSpere hypervisor.
  Use this new copy as a base image for the virtual machine.

. Create and name a new virtual machine based on the Guest OS Family [systemitem]``Linux`` and Guest OS Version {sle} 15 (64-bit).

. Add an additional [systemitem]``Hard Disk 2`` of 500 GB (or more).

. Configure RAM and number of CPUs (at least 16 GB RAM and 4 CPUs).

. Set the network adapter as required.

. Power on the VM.

. At the JeOS Firstboot screen select start to continue and check the following configuration dialogs (keyboard layout, license agreement, time zone, password for root).

. When installation completes log in as root.

. Proceed with xref:installation-and-upgrade:install-vm.adoc#minimal.susemgr.prep[].



[[minimal.susemgr.prep]]
== Preparing Virtual Machine for {productname}

Before starting obtain your SUSE Manager Registration Code from SUSE Customer Center - https://scc.suse.com.



[[proc.minimal.susemgr.prep]]
.Procedure: Preparing for {productname} run

. Log in as `root`.

. Register {productname} with SCC.
  For example, replace `<productnumber>` with `{productnumber}` and `<architecture>` with `x86_64`:
+

----
SUSEConnect -e <EMAIL_ADDRESS> -r <SUSE_MANAGER_CODE> \
  -p SUSE-Manager-Server/<productnumber>/<architecture>
----

. Validate the authorized extensions by running the list extensions command:
+

----
SUSEConnect --list-extensions
----

. Add {productname} repositories:
+

----
SUSEConnect -p sle-module-basesystem/15.4/x86_64
SUSEConnect -p sle-module-server-applications/15.4/x86_64
SUSEConnect -p sle-module-web-scripting/15.4/x86_64
SUSEConnect -p sle-module-suse-manager-server/<productnumber>/x86_64
----

. Prepare {productname} storage:
  [path]``suma-storage`` command automatically prepares and configures previously created external storage for use with {productname}.
  In the following command the first parameter is the device for {productname} data, the second parameter is the device for the database.
+

----
suma-storage /dev/vdb /dev/vdc
----
+
// FIXME info about network configuration and applying update in readme

. The virtual machine is now ready for {productname} to be set up.

For proceeding with {productname} setup, see xref:installation-and-upgrade:server-setup.adoc[SUSE Manager Setup].
