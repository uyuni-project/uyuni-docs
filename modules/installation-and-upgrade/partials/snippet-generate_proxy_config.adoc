== Generate Proxy Configuration


The configuration archive of the {productname} Proxy is generated by the {productname} Server.
Each additional Proxy requires its own configuration archive.

For the containerized {productname} Proxy, you must build a new proxy configuration file and then redeploy the container for the changes to take effect. 
This is the process for updating settings, including the SSL certificate.

//[NOTE]
//====
//2 GB represents the default proxy squid cache size.
//This will need to be adjusted for your environment.
//====

[IMPORTANT]
====
For Podman deployment, the container host for the {productname} Proxy must be registered as a client to the {productname} Server prior to generating this proxy configuration.
====

If a proxy FQDN is used to generate a proxy container configuration that is not a registered client (as in the Kubernetes use case), a new system entry will appear in system list.
This new entry will be shown under previously entered Proxy FQDN value and will be of [literal]``Foreign`` system type.

// tag::generate-proxy-config-section[]
=== Generate the Proxy Configuration with {webui}

.Procedure: Generating a Proxy Container Configuration Using {webui}
[role=procedure]
_____

. In the {webui}, navigate to menu:Systems[Proxy Configuration] and fill the required data:

. In the [guimenu]``Proxy FQDN`` field type fully qualified domain name for the proxy.

. In the [guimenu]``Parent FQDN`` field type fully qualified domain name for the {productname} Server or another {productname} Proxy.

. In the [guimenu]``Proxy SSH port`` field type SSH port on which SSH service is listening on {productname} Proxy. Recommended is to keep default 8022.

. In the [guimenu]``Max Squid cache size [MB]`` field type maximal allowed size for Squid cache.
  Recommended is to use at most 80% of available storage for the containers.

+

[NOTE]
====
2 GB represents the default proxy squid cache size.
This will need to be adjusted for your environment.
====

. In the [guimenu]``SSL certificate`` selection list choose if new server certificate should be generated for {productname} Proxy or an existing one should be used.
You can consider generated certificates as {productname} builtin (self signed) certificates.

+

Depending on the choice then provide either path to signing CA certificate to generate a new certificate or path to an existing certificate and its key to be used as proxy certificate.

+

The CA certificates generated by the server are stored in the [path]``/var/lib/containers/storage/volumes/root/_data/ssl-build`` directory.

+

For more information about existing or custom certificates and the concept of corporate and intermediate certificates, see  xref:administration:ssl-certs-imported.adoc[].

. Click btn:[Generate] to register a new proxy FQDN in the {productname} Server and generate a configuration archive ([filename]``config.tar.gz``) containing details for the container host.

. After a few moments you are presented with file to download.
  Save this file locally.

_____


=== Generate Proxy Configuration With [literal]``spacecmd`` and Self-Signed Certificate

You can generate a Proxy configuration using [literal]``spacecmd``.

.Procedure: Generating Proxy Configuration with spacecmd and Self-Signed Certificate
[role=procedure]
_____

. SSH into your container host.

. Execute the following command replacing the Server and Proxy FQDN:

+

----
mgrctl exec -ti 'spacecmd proxy_container_config_generate_cert -- dev-pxy.example.com dev-srv.example.com 2048 email@example.com -o /tmp/config.tar.gz'
----

. Copy the generated configuration from the server container:

+

----
mgrctl cp server:/tmp/config.tar.gz .
----

_____



=== Generate Proxy Configuration With [literal]``spacecmd`` and Custom Certificate

You can generate a Proxy configuration using [literal]``spacecmd`` for custom certificates rather than the default self-signed certificates.

.Procedure: Generating Proxy Configuration with spacecmd and Custom Certificate
[role=procedure]
_____

. SSH into your Server container host.

. Execute the following commands, replacing the Server and Proxy FQDN:

+
----
for f in ca.crt proxy.crt proxy.key; do
  mgrctl cp $f server:/tmp/$f
done
mgrctl exec -ti 'spacecmd proxy_container_config -- -p 8022 pxy.example.com srv.example.com 2048 email@example.com /tmp/ca.crt /tmp/proxy.crt /tmp/proxy.key -o /tmp/config.tar.gz'
----

+
. If your setup uses an intermediate CA, copy it as well and include it in the command with the `-i` option (can be provided multiple times if needed) :

+
----
mgrctl cp intermediateCA.pem server:/tmp/intermediateCA.pem
mgrctl exec -ti 'spacecmd proxy_container_config -- -p 8022 -i /tmp/intermediateCA.pem pxy.example.com srv.example.com 2048 email@example.com /tmp/ca.crt /tmp/proxy.crt /tmp/proxy.key -o /tmp/config.tar.gz'
----

. Copy the generated configuration from the server container:
+
----
mgrctl cp server:/tmp/config.tar.gz .
----

_____

// end::generate-proxy-config-section[]
