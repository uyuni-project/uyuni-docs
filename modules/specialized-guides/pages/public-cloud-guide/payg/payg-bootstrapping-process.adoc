= {payg} Client connections and bootstrapping

== Managing and bootstrapping PAYG and BYOS images

PAYG (Pay-As-You-Go) Images::
Connecting and bootstrapping PAYG images is supported and can be done without additional prerequisites.


BYOS (Bring Your Own Subscription) Images::
Bootstrapping BYOS images requires SCC (SUSE Customer Center) credentials beforehand. If a user attempts to onboard a BYOS image without providing SCC credentials, the operation will fail, as these credentials are required to verify your subscription.

[IMPORTANT]
====
* Always verify the type of image (PAYG or BYOS) prior to initiating the bootstrapping process with {productname} to ensure a smooth and error-free connection.

* If you have SCC credentials ensure your SCC credentials are valid and have the necessary permissions for utilizing BYOS images.

**Do not** register PAYG instances with the SUSE Customer Center.
Only BYOS instances should be registered against the SUSE Customer Center.

**Registering PAYG instances with the SUSE Customer Center or your own RMT server will create conflicts that are not easily solved**.  PAYG instances are automatically registered against the correct update server when added to your cloud service provider {productname} instance.
====

== Adding additional {payg} SUSE products as clients

.Procedure: Deploying {payg} SUSE Linux Enterprise instances in AWS

. Search for the {sle} {payg} instance on AWS.

. Configure the instance as needed.

. Start the instance.

For more information on using {suse} products in the public cloud see: link:https://documentation.suse.com/sle-public-cloud/all/html/public-cloud/cha-intro.html[SUSE Linux Enterprise Public Cloud Guide]


== Connecting {payg} {sle} instances to {payg} instances of {productname}

.Procedure: Connecting {payg} {sle} instances to {payg} instances of {productname}

. Return to the SUSE Manager Server WebUI.

. Navigate to menu:Admin[Setup Wizard > Pay-as-you-go] and click the btn:[+Add Pay-as-you-go] button.

. Add a description.

. Complete the instance SSH connection data:
  * Host: `URL of the machine`
  * SSH Port: `22`
  * User: `<user>`
  * Password: `<password>`
  * SSH Private Key

. Click btn:[Create] and wait for the sync to finish.

. Proceed to menu:Admin[Setup Wizard > Products] to access your {payg} SUSE Linux Enterprise products.

== Billing Services and Troubleshooting

billing-data-service::
Serves billing data from {productname} for the **CSP-billing-adapter**
The service is reachable at: 

- http://localhost:18888/
- http://localhost:18888/metering

This service is maintained by the {productname} team
The service only logs in the **systemd journal**.

**Billing services** must be running or the spacewalk will refuse to start.

csp-billing-adapter-service::
This service reports the billing data to the cloud provider (AWS, AZURE, GCP).
These logs are stored in `/var/log/csp_billing_aadapter.log`.
Additional status information can be located in `/var/lib/csp-billing-adapter/csp-config.json`
This service is maintained by public cloud team.

mgr-check-payg.service::
This service checks if **billing-data-service** is installed and running.
It also checks if the **csp-billing-adapter-service** is installed and running.
If these services are not running or installed it will attempt to install and start the service.

Consequences:: 
If one of the previous billing services is not running and cannot be installed or started **spacewalk** will refuse to start

Check `journalctl -u mgr-check-payg.service` for additional issues.

Continuous Compliance checks::
* The **payg-dimension-computation** taskomatic task must be active.

* Is the billing server running at http://localhost:18888/?

* Is the **csp-billing-adapter.service** running?

* What is the status of the **csp-billing-aadapter** located in `/var/lib/csp-billing-adapter/csp-config.json`.

The following files and packages are checked for tampering::
* Billing-data-service
* Csp-billing-adapter-service
* Python3-csp-billing-adapter
* Python3-csp-billing-adapter-local
* Python3-csp-billing-adapter-amazon
* python3-csp-billing-adapter-azure

