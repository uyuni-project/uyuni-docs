[[ref-cli-mgrcfg]]
= Configuration CLI Tools

The `mgrcfg` CLI tool has three components:


[[mgrcfg-components]]
.Configuration CLI Tool Components
[cols="1,1,1", options="header"]
|===
| Tool name | Installed on | Use for
| ``mgrcfg-client`` | Client | Managing client configuration
| ``mgr-cfg-manager`` | Server | Managing server configuration
| ``mgr-actions-control`` | Server | Administer configuration settings
|===


Clients do not have configuration management enabled by default.
To get started, install the ``mgr-actions-control`` tool on the {productname} Server, and use it to enable configuration management for your organization.



== Actions Control (mgr-actions-control)

Use the ``mgr-actions-control`` tool to enable and disable configuration management on a client.
Actions that can be performed with ``mgr-actions-control`` include:

* Deploy a configuration file on a client
* Upload a file from the client
* Compare the configuration tools available on a client, with what is being used
* Run remote commands


[IMPORTANT]
====
You must be logged in to a {productname} administrator account to use ``mgr-actions-control``.
====

This tool works by adding or removing files and directories on the client in the [path]``/etc/sysconfig/rhn/allowed-actions/`` directory.
By default, this directory requires root permissions.

The available options for ``mgr-actions-control`` are listed in this table.
Use this syntax for ``mgr-actions-control`` commands:

----
mgr-actions-control [-h] [--version] [-v] [--option]
----


[[mgractionscontrol-options]]
.Action Control Options
[cols="1,1m1", options="header"]
|===
| Option
| Abbreviated Option
| Description

| enable-all
|
| Enable all options

| disable-all
|
| Disable all options.

| enable-deploy
|
| Allow mgrcfg-client to deploy files.

| enable-diff
|
| Allow mgrcfg-client to diff files.

| enable-upload
|
| Allow mgrcfg-client to upload files.

| enable-mtime-upload
|
| Allow mgrcfg-client to upload file modification time.

| enable-run
|
| Enable running scripts.

| disable-deploy
|
| Disable deployment.

| disable-diff
|
| Disable diff use.

| disable-upload
|
| Disable file uploads.

|disable-mtime-upload
|
| Disable modification time upload.

| disable-run
|
| Disable running scripts.

| report
|
| Report whether modes are enabled or disabled.

| force
| f
| Force the operation without asking first.

| help
| h
| Show help message and exit.

|===


For more information about the available options for the ``mgr-actions-control`` tool, see the man page:
----
man mgr-actions-control
----



== Client Configuration (mgrcfg-client)

Use the ``mgrcfg-client`` tool to manage configuration on a client.
The ``mgrcfg-client`` has these primary modes:

* list
* get
* channels
* diff
* verify

The available commands and arguments for `mgrcfg-client`` are listed in this section.
Use this syntax for ``mgr-actions-control`` commands:

----
mgrcfg-client [-h] [--version] [-v] [--option] {list,get,channels,diff,verify}
----



=== List Configuration Files

The ``list`` mode lists the configuration files for the client, including the labels of the configuration channels containing them.
To see a complete list of all the configuration files that are currently applied to the client, use this command:

----
mgrcfg-client list
----

The output looks like this:

----
DoFoS   Config Channel      File
F      config-channel-17   /etc/example-config.txt
F      config-channel-17   /var/spool/aalib.rpm
F      config-channel-14   /etc/rhn/rhn.conf
----

In this output, ``DoFoS`` means ``Directory, File, or Something else``.
Each entry in the output will be marked with ``D``, ``F``, or ``S``.
These configuration files apply to the client.

Get more detail about a channel by specifying the channel name:

----
mgrcfg-manager list config-channel-14
----

The output looks like this:

----
Files in config channel 'config-channel-14'
/etc/example-config.txt /etc/rhn/rhn.conf
----

It is possible that there are duplicate configuration files in different channels.
In this case, the file listing for the channel shows files that are not present when listing channels applied to the client.
This is a result of file ranking, which means that channels can contain files that are not applied to the client, because they are outranked by a different file from a different channel.



=== Get Configuration Files

The ``get`` mode displays the contents of the primary configuration file for the client.
To see the configuration file with the highest rank within the channel, use this command:

----
mgrcfg-client get
----

To see a specific configuration file, use this command:

----
mgrcfg-client get <FILENAME>
----


The available options for ``mgrcfg-client get`` are listed in this table.

[[mgrcfg-client-get-options]]
.Client Get Mode Options
[cols="1,1m1", options="header"]
|===
| Option
| Abbreviated Option
| Description

| topdir=TOPDIR
|
| Make all file operations relative to this string.

| exclude=EXCLUDE
|
| Exclude a file from being deployed with get.
  Can be used multiple times.

| help
| h
| Show help message and exit.

|===



=== Channels

The ``channels`` mode lists the configuration channels for the client.
To see a complete list of all the configuration channels that are currently applied to the client, use this command:

----
mgrcfg-client channels
----

The output looks like this:

----
Config channels:
Label                   Name
-----                   ----
config-channel-17       config chan 2
config-channel-14       config chan 1
----



=== Differentiating Configuration Files

The ``diff`` mode shows the differences between the configuration files deployed on the client and those stored by {productname}.
Use this command:

----
mgrcfg-client diff
----

The output looks like this:

----
rhncfg-client diff
--- /etc/test
+++ /etc/test 2013-08-28 00:14:49.405152824 +1000
@@ -1 +1,2 @@
This is the first line
+This is the second line added
----

You can use the [option]``--topdir`` option to compare configuration files with those located in an arbitrary unused location on the client, like this:

----
# mgrcfg-client diff --topdir /home/test/example/
----



=== Verify Configuration Files

The ``verify`` mode checks if the configuration file on the client is different to the configuration associated with it.
Use this command:

----
mgrcfg-client verify
----

The output looks like this:

----
modified /etc/example-config.txt /var/spool/aalib.rpm
----

The file [filename]``example-config.txt`` is locally modified, while [package]``aalib.rpm`` is not.

The available options for ``mgrcfg-client verify`` are listed in this table.

[[mgrcfg-client-verify-options]]
.Client Verify Mode Options
[cols="1,1m1", options="header"]
|===
| Option
| Abbreviated Option
| Description

| verbose
| v
| Increase the amount of output detail.

| only
| o
| Only show differing files.

| help
| h
| Show help message and exit.

|===



// Lana you're up to here! 2020-10-08
[[the.configuration.manager]]
== Configuration Manager (mgrcfg-manager)

The Configuration Manager (*mgrcfg-manager*) is designed to maintain {productname}'s central repository of config files and channels, not those located on client systems.
This tool offers a command line alternative to the configuration management features in the {productname} {webui}.
Additionally, some or all of the related maintenance tasks can be scripted.

To use the command line interface, configuration administrators require a {productname} account (username and password) with the appropriate permission set.
The username may be specified in [path]``/etc/sysconfig/rhn/rhncfg-manager.conf`` or in the [option]``[rhncfg-manager]`` section of [path]``~/.rhncfgrc``.

When the Configuration Manager is run as *root*, it attempts to pull in needed configuration values from the Red Hat Update Agent.
When run as a user other than root, you may have to change the [path]``~/.rhncfgrc`` configuration file.
The session file is cached in [path]``~/.rhncfg-manager-session`` to avoid having to log in for every command.

The default timeout for the Configuration Manager is 30 minutes.
To adjust this, add the [option]``server.session_lifetime`` option and a new value to the [path]``/etc/rhn/rhn.conf`` file on the server running the manager.
For example set the time out to *120 minutes*:

----
server.session_lifetime = 120
----

The Configuration Manager offers the following primary *modes*:

* add
* create-channel
* diff
* diff-revisions
* download-channel
* get
* list
* list-channels
* remove
* remove-channel
* revisions
* update
* upload-channel

Each mode offers its own set of options, which can be displayed by issuing the following command:

----
mgrcfg-manager mode --help
----

Replace mode with the name of the mode whose options you want to see:

----
mgrcfg-manager diff-revisions --help
----



[[creating.a.config.channel]]
=== Creating a Config Channel

To create a config channel for your organization, issue the command:

----
mgrcfg-manager create-channel channel-label
----

If prompted for your {productname} username and password, provide them.
Once you have created a config channel, use the remaining modes listed above to populate and maintain that channel.



[[adding.files.to.a.config.channel]]
=== Adding Files to a Config Channel

To add a file to a config channel, specify the channel label and the local file to be uploaded:

----
mgrcfg-manager add --channel=channel-label /path/to/file
----

In addition to the required channel label and the path to the file, you can use the available options for modifying the file during its addition.
For instance, you can alter the path and file name by including the [option]``--dest-file`` option in the command:

----
mgrcfg-manager add --channel=channel-label \
  --dest-file=/new/path/to/file.txt/path/to/file
----

The output resembles the following:

----
Pushing to channel example-channel
Local file >/path/to/file -> remote file /new/path/to/file.txt
----

The list of options available for mgrcfg-manager add:

-c CHANNEL --channel=CHANNEL::
Upload files in this config channel.

-d DEST_FILE --dest-file=DEST_FILE::
Upload the file as this path.

--delim-start=DELIM_START::
Start delimiter for variable interpolation.

--delim-end=DELIM_END::
End delimiter for variable interpolation.

-i, --ignore-missing::
Ignore missing local files.

-h, --help::
Show help message and exit.


[TIP]
.Maximum File Size
====
By default, the maximum file size for configuration files is 128 KB.
For information on changing the maximum file size value, see xref:reference:configuration/config-files-menu.adoc[].
====



[[diff.between.latest.config.files]]
=== Differentiating between Latest Config Files

To view the differences between the config files on disk and the latest revisions in a channel, issue the command:

----
mgrcfg-manager diff --channel=channel-label --dest-file=/path/to/file.txt \
/local/path/to/file
----

You should see output resembling:

----
--- /tmp/dest_path/example-config.txt config_channel: example-channel revision: 1
+++ /home/test/blah/hello_world.txt 2003-12-14 19:08:59.000000000 -0500
@@ -1 +1 @@
-foo
+hello, world
----

The list of options available for [command]``mgrcfg-manager diff``:

-c CHANNEL, --channel=CHANNEL::
Get file(s) from this config channel.

-r REVISION, --revision=REVISION::
Use this revision.

-d DEST_FILE, --dest-file=DEST_FILE::
Upload the file at this path.

-t TOPDIR, --topdir=TOPDIR::
Make all files relative to this string.

-h, --help::
Show help message and exit.



[[diff.between.various.versions]]
=== Differentiating between Various Versions

To compare different versions of a file across channels and revisions, use the *-r* flag to indicate which revision of the file should be compared and the *-n* flag to identify the two channels to be checked.
Specify only one file name here since you are comparing the file against another version of itself.
For example:

----
mgrcfg-manager diff-revisions -n=channel-label1 -r=1 \
  -n=channel-label2 -r=1 \
  /path/to/file.txt
----

The output resembles the following:

----
--- /tmp/dest_path/example-config.txt 2004-01-13 14:36:41 \
config channel: example-channel2 revision: 1
--- /tmp/dest_path/example-config.txt 2004-01-13 14:42:42 \
config channel: example-channel3 revision: 1
@@ -1 +1,20 @@
-foo
+blah
+-----BEGIN PGP SIGNATURE-----
+Version: GnuPG v1.0.6 (GNU/Linux)
+Comment: For info see http://www.gnupg.org
+
+iD8DBQA9ZY6vse4XmfJPGwgRAsHcAJ9ud9dabUcdscdcqB8AZP7e0Fua0NmKsdhQCeOWHX
+VsDTfen2NWdwwPaTM+S+Cow=
+=Ltp2
+-----END PGP SIGNATURE-----
----

The list of options available for [command]``mgrcfg-manager diff-revisions``:

-c CHANNEL, --channel=CHANNEL::
Use this config channel.

-r REVISION, --revision=REVISION::
Use this revision.

-h, --help::
Show help message and exit.



[[downloading.all.files.in.a.channel]]
=== Downloading All Files in a Channel

To download all the files in a channel to disk, create a directory and issue the following command:

----
mgrcfg-manager download-channel channel-label --topdir .
----

The output resembles the following:

----
Copying /tmp/dest_path/example-config.txt -> \
blah2/tmp/dest_path/example-config.txt
----

The list of options available for mgrcfg-manager download-channel:

-t TOPDIR, --topdir=TOPDIR::
Directory to which all the file paths are relative. This option must be set.

-h, --help::
Show help message and exit.



[[getting.the.contents.of.a.file]]
=== Getting the Contents of a File

To direct the contents of a particular file to stdout, issue the command:

----
mgrcfg-manager get --channel=channel-label \
/tmp/dest_path/example-config.txt
----

You should see the contents of the file as the output.



[[listing.all.files.in.a.channel]]
=== Listing All Files in a Channel

To list all the files in a channel, issue the command:

----
mgrcfg-manager list channel-label
----

You should see output resembling:

----
Files in config channel `example-channel3':
/tmp/dest_path/example-config.txt
----

The list of the options available for mgrcfg-manager get:

-c CHANNEL, --channel=CHANNEL::
Get file(s) from this config channel.

-t TOPDIR, --topdir=TOPDIR::
Directory to which all files are relative.

-r REVISION, --revision=REVISION::
Get this file revision.

-h, --help::
Show help message and exit.



[[listing.all.config.channels]]
=== Listing All Config Channels
To list all of your organization's configuration channels, issue the command:

----
mgrcfg-manager list-channels
----

The output resembles the following:

----
Available config channels:
example-channel example-channel2 example-channel3 config-channel-14 config-channel-17
----

[NOTE]
====
This does not list *local_override* or *server_import* channels.
====


[[removing.a.file.from.a.channel]]
=== Removing a File from a Channel
To remove a file from a channel, issue the command:

----
mgrcfg-manager remove --channel=channel-label /tmp/dest_path/example-config.txt
----

If prompted for your {productname} username and password, provide them.

The list of the options available for mgrcfg-manager remove:

-c CHANNEL, --channel=CHANNEL::
Remove files from this config channel.

-t TOPDIR, --topdir=TOPDIR::
Directory to which all files are relative.

-h, --help::
Show help message and exit.



[[deleting.a.config.channel]]
=== Deleting a Config Channel

To remove a config channel in your organization, issue the command:

----
mgrcfg-manager remove-channel channel-label
----

The output resembles the following:

----
Removing config channel example-channel
Config channel example-channel removed
----



[[determine.the.number.of.file.revisions]]
=== Determining the Number of File Revisions

To find out how many revisions (from *1 to N* where N is an integer greater than 0) of a file/path are in a channel, issue the following command:

----
mgrcfg-manager revisions channel-label /tmp/dest_path/example-config.txt
----

The output resembles the following:

----
Analyzing files in config channel example-channel \
/tmp/dest_path/example-config.txt: 1
----



[[update.a.file.in.a.channel]]
=== Updating a File in a Channel

To create a new revision of a file in a channel (or to add the first revision to that channel if none existed before for the given path), issue the following command:

----
mgrcfg-manager update --channel=channel-label \
--dest-file=/path/to/file.txt /local/path/to/file
----

The output resembles the following:

----
Pushing to channel example-channel:
Local file example-channel /tmp/local/example-config.txt -> \
remote file /tmp/dest_path/example-config.txt
----

The list of the options available for mgrcfg-manager update:

-c CHANNEL, --channel=CHANNEL::
Upload files in this config channel.

-d DEST_FILE, --dest-file=DEST_FILE::
Upload the file to this path.

-t TOPDIR, --topdir=TOPDIR::
Directory to which all files are relative.

--delim-start=DELIM_START::
Start delimiter for variable interpolation.

--delim-end=DELIM_END::
End delimiter for variable interpolation.

-h, --help::
Show help message and exit.



[[uploading.multiple.files.at.once]]
=== Uploading Multiple Files at Once

To upload multiple files to a config channel from a local disk at once, issue the command:

----
mgrcfg-manager upload-channel --topdir=topdir channel-label
----

The output resembles the following:

----
Using config channel example-channel4
Uploading /tmp/ola_world.txt from blah4/tmp/ola_world.txt
----

The list of the options available for mgrcfg-manager upload-channel:

-t TOPDIR, --topdir=TOPDIR::
Directory all the file paths are relative to.

-c CHANNEL, --channel=CHANNEL::
List of channels the config info will be uploaded into channels delimited by ','. Example: --channel=foo,bar,baz.

-h, --help::
Show help message and exit.
