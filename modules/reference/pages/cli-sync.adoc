[[ref-cli-sync]]
= Synchronization CLI Tools

There are several tools for synchronizing clients to the server.




[[spacewalk-repo-sync]]
== Synchronize Repositories with spacewalk-repo-sync

The [command]``spacewalk-repo-sync`` tool synchronizes software repositories into {productname} channels.
This usually happens automatically, but you can run it manually if required.
This can be useful for debugging or for solving some synchronization problems.



=== Normal Channel Synchronization

Basic operation:

[command]``spacewalk-repo-sync --list``::
List all custom channels and the repositories assigned to them.
[command]``spacewalk-repo-sync  --channel <custom-channel>``::
Synchronize a single channel ``<custom-channel>`` to all repositories assigned to it with the {webui} or the API.



=== Solve Checksum Problems

Use the [option]``--deep-verify`` option to ignore cached package checksums.
This can help with solving checksum problems.



=== Force Re-import Patches

Use the [option]``--force-all-errata`` option to force re-importing all the patches.
To make this command run faster, you can use the [option]``--no-packages`` option.
This option excludes packages from the operation.

To find the root cause of synchronization problems you can look at the HTTP log as [command]``spacewalk-repo-sync`` is running.

. Set and export [systemitem]``ZYPP_MEDIA_CURL_DEBUG``.
    This setting will allow downloading the metadata output by Zypper.
    Thus the following command will log the HTTP conversation into [path]``/var/log/zypper.log``:
+

----
ZYPP_MEDIA_CURL_DEBUG=2 spacewalk-repo-sync --channel <channel-label>
----

. Set and export [systemitem]``URLGRABBER_DEBUG`` for the RPM downloading part:
+
----
export URLGRABBER_DEBUG=DEBUG
----
. Start the synchronization:
+

----
/usr/bin/spacewalk-repo-sync --channel <channel-label> --type yum
----

To increase the debug level, add the [option]``-vvv`` option.

When debugging is finished, disable debug mode:

----
unset URLGRABBER_DEBUG
----



=== Add Custom Extra HTTP Headers

It is possible to add custom HTTP headers to the requests made by [command]``spacewalk-repo-sync`` at the time of repository and package synchronization.

The custom HTTP headers are defined in the [path]``/etc/rhn/spacewalk-repo-sync/extra_headers.conf`` configuration file.
The headers can be defined by repository name, or channel label.
You can also define global headers by putting them in the ``main`` section:

----
[testchannel]
X-MY-HEADER-1=VALUE
X-MY-HEADER-2=VALUE

[mychannel]
X-MY-HEADER-3=VALUE
X-MY-HEADER-4=VALUE

[main]
X-MYGLOBAL-HEADER=VALUE
----

This can be particularly useful when dealing with Red Hat Update Infrastructure (RHUI) repositories in the public cloud.

=== For More Information

For a complete list of command line options, see the [command]``spacewalk-repo-sync`` manpage:

----
man spacewalk-repo-sync
----



[[syncing.suse.mgr.repositories.scc]]
== Synchronize Repositories from SCC (mgr-sync)

[command]``mgr-sync`` should be used if {productname} is connected to SUSE Customer Center (SCC).
With [command]``mgr-sync`` you may add or synchronize products and channels.
The [command]``mgr-sync`` command also enables and refreshes SCC data.

By default, [command]``mgr-sync`` writes basic debug information to [path]``/var/log/rhn/mgr-sync.log``.
Get more debugging information with [option]``--debug`` or by adding [literal]``mgrsync.debug = <DEBUGLEVEL>`` to [path]``/etc/rhn/rhn.conf``.
Settings in [path]``~/.mgr-sync`` will supersede values from [path]``rhn.conf``. For example, if you set
----
mgrsync.debug = ""
----
in [path]``~/.mgr-sync``, the value in [path]``rhn.conf`` will have no effect.

[IMPORTANT]
.Admin credentials
====
[command]``mgr-sync`` requires username and password of a *{productname} administrator*.
Most functions are available as part of the public API.
====

mgr-sync provides a command structure with sub-commands similar to git or osc.
For a complete list of command line option, see the mgr-sync manpage (man mgr-sync).
Basic actions are:

----
mgr-sync list channel(s)|product(s)|credentials
mgr-sync add  channel(s)|product(s)|credentials
mgr-sync delete  credentials

mgr-sync refresh [--refresh-channels] [--from-mirror MIRROR]
----

See the following examples.

List channels::
+

----
mgr-sync list channels
----

Add a channel::
+

----
mgr-sync add channel LABEL
----

List products::
+

----
mgr-sync list products
----

Add a product::
+

----
mgr-sync add product
----

Refresh the data::
+

----
mgr-sync refresh
----

Refresh data and schedule a reposync for all installed vendor channels::
+

----
mgr-sync refresh --refresh-channels
----

List SCC credentials::
+

----
mgr-sync list credentials
----

Add new SCC credentials::
+

----
mgr-sync add credentials
----

[TIP]
.Credentials
====
There can be one primary credential only.
This is username/password used first when retrieving the list of available channels and packages.
====

Add SCC primary credentials::
+

----
mgr-sync add credentials --primary
----

Delete SCC credentials::
+

----
mgr-sync delete credentials
----
