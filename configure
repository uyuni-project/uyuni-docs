#!/usr/bin/env python3

#Import necessary functions from Jinja2 module
from jinja2 import Environment, FileSystemLoader
import shutil

#Import YAML module
import yaml

#Load lang parameters 
config_data = yaml.load(open('./parameters.yml'), Loader=yaml.FullLoader)
print("Config file loaded successfully")

#Load Jinja2 template
env = Environment(loader = FileSystemLoader('./'), trim_blocks=True, lstrip_blocks=True)
template_lang = env.get_template('Makefile.j2')

print("Creating Makefile for each language..")
#Create makefile for each language from template
for i in config_data["languages"]:
    with open('Makefile.' + i["langcode"], 'w') as f:
        print(template_lang.render(i), file=f)
        f.close()
print("Makefiles successfully created")

print("Including new Makefiles in Makefile.lang")
#include the new makefile in the main one
with open('Makefile.lang', 'a') as f:
    f.truncate(0)
    for i in config_data["languages"]:
        f.write('include ' + 'Makefile.' + i["langcode"] + '\n')
    f.close()

#Create books target
print("Creating new target using books target..")
template_target = env.get_template('Makefile.section.functions.j2')
with open('Makefile.section.functions', 'w') as f:
    print(template_target.render(config_data), file=f)
    f.close()

#Create common target
template_target = env.get_template('Makefile.lang.target.j2')
print("Creating new target using language target..")
with open('Makefile.lang.target', 'w') as f:
    print(template_target.render(config_data), file=f)
    f.close()
print("Configuration Completed!")
