<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<title>Custom Salt States
     | SUSE Manager 4.3 Documentation</title>    <link rel="canonical" href="https://documentation.suse.com/suma/4.3/en/suse-manager/specialized-guides/salt/salt-custom-states.html">
    <link rel="prev" href="salt-gpg-encrypted-pillars.html">
    <link rel="next" href="salt-file-locations.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<!-- <link rel="preconnect" href="https://fonts.gstatic.com"> -->
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js"
        type="text/javascript"></script>
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
   <div class="navbar-brand">
            <div class="navbar-item">
                <a class=" navbar-logo" href="https://documentation.suse.com/suma/"><img
                        class="logo" src="../../../_/img/logo.svg"/></a>
            </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
     <div id="topbar-nav" class="navbar-menu">
          <div class="navbar-end">
              <div class="navbar-item has-dropdown is-hoverable">
                  <div class="navbar-link"><img src="../../../_/img/resources.png" class="langIcon Resurces" alt="Resources" title="Resources"></div>
                  <div class="navbar-dropdown">
                      <!--  <div class="navbar-item"><strong>Resources</strong></div> -->
                      <a class="navbar-item" href="https://github.com/uyuni-project/uyuni-docs"><i
                              class="fab fa-github"></i>&nbsp;uyuni-docs</a>
                      <a class="navbar-item" href="https://github.com/uyuni-project/uyuni-docs/issues"><i
                              class="fab fa-github"></i>&nbsp;Report Issue</a>
                      <a class="navbar-item"
                         href="https://github.com/uyuni-project/uyuni-docs/wiki"><i
                              class="fas fa-user-edit"></i>&nbsp;Contribute</a>
                  </div>
              </div>
                           <div class="navbar-item has-dropdown is-hoverable">
                 <div class="navbar-link"><img src="../../../_/img/language.png" class="langIcon Language" alt="Language" title="Language"></div>
                 <div class="navbar-dropdown">
                     <!--  </div><div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->
                     <a role="button" class="navbar-item" id="en" onclick="selectLanguage(this.id)"><img src="../../../_/img/engFlag.svg" class="langIcon english">&nbsp;English</a>
                     <!-- LANGUAGESELECTOR -->
                     <a role="button" class="navbar-item" id="ko" onclick="selectLanguage(this.id)"><img src="../../../_/img/koFlag.svg" class="langIcon korea">&nbsp;한국어</a>
                     <a role="button" class="navbar-item" id="ja" onclick="selectLanguage(this.id)"><img src="../../../_/img/jaFlag.svg" class="langIcon japan">&nbsp;日本語</a>
                     <a role="button" class="navbar-item" id="zh_CN" onclick="selectLanguage(this.id)"><img src="../../../_/img/china.svg" class="langIcon china">&nbsp;中文</a>
                 </div>
             </div>
                
          </div>
      </div>
      <a id="twitter-link" class="navbar-item" href="https://twitter.com/susemanager">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 512 512">
              <path fill="#57aaee"
                    d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
      </a>
   <!--   <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
      </div> -->
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="suse-manager" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">SUSE Manager 4.3 Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../common_gfdl1.2_i.html">License</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides-overview.html">Specialized Guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../public-cloud-guide/overview.html">Public Cloud Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Generic Public Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../public-cloud-guide/setup.html">Initial Setup</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../public-cloud-guide/clients.html">Client Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">PAYG Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-overview.html">Pay-as-you-go Overview</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-benefits.html">Benefits of PAYG</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">PAYG on AWS</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-faq.html">PAYG FAQ on AWS</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-country-listing.html">Supported Country List</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-aws-requirements.html">SUSE Manager AWS requirements</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-find-the-aws-image.html">Find the Image</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-configure-the-image.html">Configure the Image on EC2</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-start-the-image.html">Start the Instance</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-initial-setup.html">Initial Setup</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-start-the-server.html">Start the Server</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../public-cloud-guide/payg/payg-webui-configuration.html">WebUI Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="salt-overview.html">Salt Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-command.html">Salt Command</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-useful-commands.html">Common Salt Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-states-and-pillars.html">Salt States and Pillars</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-gpg-encrypted-pillars.html">GPG Encrypted Pillars</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="salt-custom-states.html">Custom Salt States</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-file-locations.html">File Locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-gitfs.html">GitFS Fileserver Backend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-yomi.html">Install Using Yomi</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-config-modules.html">Configuration Modules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="salt-formulas-intro.html">Salt Formulas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formulas-by-product.html">Formulas provided by SUSE Manager</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-bind.html">Bind Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-branchnetwork.html">Branch Network Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-dhcpd.html">DHCPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-imagesync.html">Image Sync Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-monitoring.html">Monitoring Formulas</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-pxe.html">PXE Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-saltboot.html">Saltboot Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-tftpd.html">TFTPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-vsftpd.html">VsFTPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formula-yomi.html">Yomi Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="salt-formulas-custom.html">Custom Salt Formulas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-ssh.html">Salt SSH</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-rate-limiting.html">Rate Limiting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="salt-scaling-minions.html">Scaling Minions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../large-deployments/overview.html">Large Deployments Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../large-deployments/hardware-reqs.html">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../large-deployments/single-server.html">Single Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../large-deployments/operation-reqs.html">Operation Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../large-deployments/multi-server.html">Multiple Servers with Hub</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../large-deployments/hub-reqs.html">Hub Operation Requirements</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../large-deployments/hub-install.html">Hub Installation</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../large-deployments/hub-api.html">Hub API</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../large-deployments/hub-namespaces.html">Hub Namespaces</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../large-deployments/hub-auth.html">Hub Authentication</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../large-deployments/hub-reporting.html">Hub Reporting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../large-deployments/retail-large-scale.html">Large Retail Environments</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../large-deployments/tuning.html">Tuning Large Installations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text">xref:large-deployments/monitoring.adoc[Monitoring Large Scale Deployments</span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../qs-sap/overview.html">Quick Start: SAP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../qs-sap/prepare-server.html">Prepare Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../qs-sap/prepare-clients.html">Prepare Clients</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../qs-sap/configure.html">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE Manager 4.3 Documentation</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">SUSE Manager 4.3 Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">SUSE Manager 4.3 Documentation</a></li>
    <li><a href="../specialized-guides-overview.html">Specialized Guides</a></li>
    <li><a href="salt-overview.html">Salt Guide</a></li>
    <li><a href="salt-custom-states.html">Custom Salt States</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Custom Salt States</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_create_a_new_customsalt_channel">1. Create a New Custom Salt Channel</a></li>
<li><a href="#_example_custom_state_files">2. Example Custom State Files</a></li>
<li><a href="#_custom_state_to_trust_a_gpgkey">3. Custom State to Trust a GPG Key</a></li>
<li><a href="#_apply_a_custom_state_at_highstate">4. Apply a custom state at highstate</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can create your own custom Salt states with SUSE Manager as centrally managed configuration channels.
Custom states are stored as Salt state files on the SUSE Manager Server with a <code>.sls</code> extension.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_new_customsalt_channel"><a class="anchor" href="#_create_a_new_customsalt_channel"></a><a class="link" href="#_create_a_new_customsalt_channel">1. Create a New Custom Salt Channel</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the SUSE Manager Web UI to create and edit custom Salt state files.
You must create a state channel first, with an initial state named <code>init.sls</code>.
The <code>init.sls</code> file is used to reference all other state files within the channel.
The custom states that you create using the Web UI are stored on the SUSE Manager Server in the the <code class="path">/srv/susemanager/salt/&lt;organization&gt;/</code> directory.</p>
</div>
<div class="paragraph">
<p>After the channel is created with an <code>init.sls</code> file, you can write additional state files in the Web UI.
Alternatively, you can upload existing state files to use within your state channel, or import them from other channels or clients.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Creating a Custom Salt Channel and Initial State</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Channels</b></span>.</p>
</li>
<li>
<p>Click <b class="button">Create State Channel</b>.</p>
</li>
<li>
<p>In the <code class="guimenu">Name</code> field, type a name for your state.</p>
</li>
<li>
<p>In the <code class="guimenu">Label</code> field, type a label.
Use alphanumeric characters, hyphens, and underscores.
Do not use spaces.</p>
</li>
<li>
<p>In the <code class="guimenu">Description</code> field, type a short description of the configuration your state performs.</p>
</li>
<li>
<p>In the <code class="guimenu">SLS Contents</code> field, type the contents of your <code>init.sls</code> state.
If you want to reference file templates in this configuration channel, ensure your file starts by specifying the source of the managed file, using this syntax:</p>
<div class="listingblock">
<div class="content">
<pre>file.managed:
  - source: salt://&lt;org_name&gt;/&lt;channel_name&gt;/etc/&lt;ID&gt;/&lt;filename&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Example custom state files are given later in this section.
. Click btn:[Update Channel] to save your state.</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: Adding Additional Files to a Custom State Channel</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Channels</b></span>.
. Click the name of the channel you want to add files to.</p>
</li>
<li>
<p>To create a new file, click btn:<code>Create configuration file</code> and type the contents of the file.</p>
</li>
<li>
<p>To upload an existing file, click <b class="button">Upload Configuration Files</b> and select the file to upload.</p>
</li>
<li>
<p>To copy an existing file, click <b class="button">Import a File from Another Channel or System</b> and select the file to copy.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: Editing a Custom Salt State</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Channels</b></span>.</p>
</li>
<li>
<p>Click <b class="button">View/Edit &lt;filename&gt;.sls File</b>.</p>
</li>
<li>
<p>Make your changes to the file.</p>
</li>
<li>
<p>Click <b class="button">Update Configuration File</b> to save your state.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also manage revisions, compare the state to others in your organization, and download the <code>.sls</code> file from this dialog.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Assigning a Client to a Custom Salt State</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Channels</b></span>.</p>
</li>
<li>
<p>Click the name of the state you want to assign a client to.</p>
</li>
<li>
<p>Navigate to the <span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Target Systems</b></span> tab.</p>
</li>
<li>
<p>Check the clients you want to assign.</p>
</li>
<li>
<p>Click <b class="button">Subscribe systems</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about Salt state modules, see <a href="https://docs.saltproject.io/en/latest/ref/states/all/index.html" class="bare">https://docs.saltproject.io/en/latest/ref/states/all/index.html</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_custom_state_files"><a class="anchor" href="#_example_custom_state_files"></a><a class="link" href="#_example_custom_state_files">2. Example Custom State Files</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains some example custom state files.
Use these as a basis for writing your own custom states.</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. Example: Manage a File</div>
<div class="content">
<pre>my_config_change_id:
  file.managed:
    - name: /etc/my.conf
    - source: salt://example_org/example_channel/etc/my.conf
    - user: root
    - group: root
    - mode: 644
    - template: jinja</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 2. Example: Package Management</div>
<div class="content">
<pre>my_pkg_id:
  pkg.installed:
    - refresh: True
    - pkgs:
      - glibc
      - kernel-default
      - hello: 1.0-42</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 3. Example: Remote Command</div>
<div class="content">
<pre>ip_forward-on:
  cmd.run:
    - name: echo "1" &gt; /proc/sys/net/ipv4/ip_forward
    - onlyif:
      - test `cat /proc/sys/net/ipv4/ip_forward` -eq 0</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 4. Example: Service Management</div>
<div class="content">
<pre>time_service_id:
  service.running:
    - name: chronyd
    - enable: True</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_state_to_trust_a_gpgkey"><a class="anchor" href="#_custom_state_to_trust_a_gpgkey"></a><a class="link" href="#_custom_state_to_trust_a_gpgkey">3. Custom State to Trust a GPG Key</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, operating systems trust only their own GPG keys when they are installed, and do not trust keys provided by third party packages.
The clients can be successfully bootstrapped without the GPG key being trusted.
However, you cannot install new third party packages or update them until the keys are trusted.</p>
</div>
<div class="paragraph">
<p>Salt clients are set to trust SUSE tools channels GPG keys when they are bootstrapped.
For all other clients and channels, you need to manually trust third party GPG keys.</p>
</div>
<div class="paragraph">
<p>If you are bootstrapping Salt clients from the SUSE Manager Web UI, you can use a custom Salt state to trust the GPG key.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Trusting a GPG Key With a Custom Salt State</div>
<ol class="arabic">
<li>
<p>Locate the key that you need to trust.
Ensure you have the correct key, and that you also have the fingerprint used to verify the key.
This information is available from the vendor or, in some cases, from a key server.</p>
</li>
<li>
<p>Copy the key to a file location where the client can access it.
We recommend saving it in the <code class="path">/srv/www/htdocs/pub/</code> directory, where all SUSE public keys are also saved.</p>
</li>
<li>
<p>In the SUSE Manager Web UI, navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Channels</b></span>.</p>
</li>
<li>
<p>Click <b class="button">Create State Channel</b>.</p>
</li>
<li>
<p>In the <code class="guimenu">Name</code> field, type a name for your state.
For example, <code>GPG Key Trusts</code>.</p>
</li>
<li>
<p>In the <code class="guimenu">Label</code> field, type a label.
For example, <code>GPG_Key_Trusts</code>.</p>
</li>
<li>
<p>In the <code class="guimenu">Description</code> field, type a short description of the configuration your state performs.
For example, <code>Trusts GPG Keys for CentOS</code>.</p>
</li>
<li>
<p>In the <code class="guimenu">SLS Contents</code> field, create a state to retrieve the appropriate key from the SUSE Manager Server and trust it on the client.
The exact contents of your state varies depending on your client operating system.
For example:</p>
<div class="listingblock">
<div class="content">
<pre>rpm_trust_gpg_key:
  cmd.run:
    - name: rpm --import https://{{ salt['pillar.get']('mgr_server') }}/pub/&lt;third-party-gpg&gt;.key
    - unless: rpm -q gpg-pubkey-&lt;key_id&gt;

deb_trust_gpg_key:
  mgrcompat.module_run:
    - name: pkg.add_repo_key
    - path: https://{{ salt['pillar.get']('mgr_server') }}/pub/&lt;third-party-gpg&gt;.key</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  Alternatively, you can add GPG keys to a configuration channel, using a managed file to deploy them directly on the client.
  In this case, you would use a local path to the key, rather than a URL.
. Click btn:[Update Channel] to save your state.
. Navigate to menu:Configuration[Channels] and click the name of the state you want to assign a client to.
. Navigate to the menu:Systems[Target Systems] tab and check the clients you want to assign.
. Click btn:[Subscribe systems].
 When the configuration file is next run on the client, the GPG key is trusted.</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively, you can manage your GPG keys from your own repository hosted on an external file management system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_apply_a_custom_state_at_highstate"><a class="anchor" href="#_apply_a_custom_state_at_highstate"></a><a class="link" href="#_apply_a_custom_state_at_highstate">4. Apply a custom state at highstate</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To apply a custom state at highstate create a mapping in <code class="path">/srv/salt/top.sls</code>.
This short example maps the <code class="literal">test</code> state to the system group <code class="literal">12</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># /srv/salt/top.sls
base:
  'group_ids:12':
    - match: pillar
    - test</pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="salt-gpg-encrypted-pillars.html">GPG Encrypted Pillars</a></span>
  <span class="next"><a href="salt-file-locations.html">File Locations</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>

  </body>
</html>
