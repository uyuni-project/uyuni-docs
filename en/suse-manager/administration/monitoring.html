<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<title>Monitoring with Prometheus and Grafana
     | SUSE Manager 4.3 Documentation</title>    <link rel="canonical" href="https://documentation.suse.com/suma/4.3/en/suse-manager/administration/monitoring.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/search.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../_/css/font-styles.css">
<link rel="stylesheet" href="../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../_/css/site-extra.css">
<!-- <link rel="preconnect" href="https://fonts.gstatic.com"> -->
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js"
        type="text/javascript"></script>
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
   <div class="navbar-brand">
            <div class="navbar-item">
                <a class=" navbar-logo" href="https://documentation.suse.com/suma/"><img
                        class="logo" src="../../_/img/logo.svg"/></a>
            </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
     <div id="topbar-nav" class="navbar-menu">
          <div class="navbar-end">
              <div class="navbar-item has-dropdown is-hoverable">
                  <div class="navbar-link"><img src="../../_/img/resources.png" class="langIcon Resurces" alt="Resources" title="Resources"></div>
                  <div class="navbar-dropdown">
                      <!--  <div class="navbar-item"><strong>Resources</strong></div> -->
                      <a class="navbar-item" href="https://github.com/uyuni-project/uyuni-docs"><i
                              class="fab fa-github"></i>&nbsp;uyuni-docs</a>
                      <a class="navbar-item" href="https://github.com/uyuni-project/uyuni-docs/issues"><i
                              class="fab fa-github"></i>&nbsp;Report Issue</a>
                      <a class="navbar-item"
                         href="https://github.com/uyuni-project/uyuni-docs/wiki"><i
                              class="fas fa-user-edit"></i>&nbsp;Contribute</a>
                  </div>
              </div>
                           <div class="navbar-item has-dropdown is-hoverable">
                 <div class="navbar-link"><img src="../../_/img/language.png" class="langIcon Language" alt="Language" title="Language"></div>
                 <div class="navbar-dropdown">
                     <!--  </div><div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->
                     <a role="button" class="navbar-item" id="en" onclick="selectLanguage(this.id)"><img src="../../_/img/engFlag.svg" class="langIcon english">&nbsp;English</a>
                     <!-- LANGUAGESELECTOR -->
                     <a role="button" class="navbar-item" id="ko" onclick="selectLanguage(this.id)"><img src="../../_/img/koFlag.svg" class="langIcon korea">&nbsp;한국어</a>
                     <a role="button" class="navbar-item" id="ja" onclick="selectLanguage(this.id)"><img src="../../_/img/jaFlag.svg" class="langIcon japan">&nbsp;日本語</a>
                     <a role="button" class="navbar-item" id="zh_CN" onclick="selectLanguage(this.id)"><img src="../../_/img/china.svg" class="langIcon china">&nbsp;中文</a>
                 </div>
             </div>
                
          </div>
      </div>
      <a id="twitter-link" class="navbar-item" href="https://twitter.com/susemanager">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 512 512">
              <path fill="#57aaee"
                    d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
      </a>
   <!--   <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
      </div> -->
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="suse-manager" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">SUSE Manager 4.3 Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../common_gfdl1.2_i.html">License</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/specialized-guides-overview.html">Specialized Guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/overview.html">Public Cloud Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Generic Public Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/setup.html">Initial Setup</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/clients.html">Client Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">PAYG Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-overview.html">Pay-as-you-go Overview</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-benefits.html">Benefits of PAYG</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">PAYG on AWS</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-faq.html">PAYG FAQ on AWS</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-country-listing.html">Supported Country List</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-aws-requirements.html">SUSE Manager AWS requirements</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-find-the-aws-image.html">Find the Image</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-configure-the-image.html">Configure the Image on EC2</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-start-the-image.html">Start the Instance</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-initial-setup.html">Initial Setup</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-start-the-server.html">Start the Server</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-webui-configuration.html">WebUI Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/salt/salt-overview.html">Salt Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-command.html">Salt Command</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-useful-commands.html">Common Salt Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-states-and-pillars.html">Salt States and Pillars</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-gpg-encrypted-pillars.html">GPG Encrypted Pillars</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-custom-states.html">Custom Salt States</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-file-locations.html">File Locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-gitfs.html">GitFS Fileserver Backend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-yomi.html">Install Using Yomi</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-config-modules.html">Configuration Modules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/salt/salt-formulas-intro.html">Salt Formulas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formulas-by-product.html">Formulas provided by SUSE Manager</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-bind.html">Bind Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-branchnetwork.html">Branch Network Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-dhcpd.html">DHCPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-imagesync.html">Image Sync Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-monitoring.html">Monitoring Formulas</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-pxe.html">PXE Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-saltboot.html">Saltboot Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-tftpd.html">TFTPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-vsftpd.html">VsFTPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-yomi.html">Yomi Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formulas-custom.html">Custom Salt Formulas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-ssh.html">Salt SSH</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-rate-limiting.html">Rate Limiting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-scaling-minions.html">Scaling Minions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/large-deployments/overview.html">Large Deployments Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/large-deployments/hardware-reqs.html">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/large-deployments/single-server.html">Single Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/operation-reqs.html">Operation Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/large-deployments/multi-server.html">Multiple Servers with Hub</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-reqs.html">Hub Operation Requirements</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-install.html">Hub Installation</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-api.html">Hub API</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-namespaces.html">Hub Namespaces</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-auth.html">Hub Authentication</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-reporting.html">Hub Reporting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/large-deployments/retail-large-scale.html">Large Retail Environments</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/large-deployments/tuning.html">Tuning Large Installations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text">xref:large-deployments/monitoring.adoc[Monitoring Large Scale Deployments</span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/qs-sap/overview.html">Quick Start: SAP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/qs-sap/prepare-server.html">Prepare Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/qs-sap/prepare-clients.html">Prepare Clients</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/qs-sap/configure.html">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE Manager 4.3 Documentation</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">SUSE Manager 4.3 Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">SUSE Manager 4.3 Documentation</a></li>
    <li><a href="monitoring.html">Monitoring with Prometheus and Grafana</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Monitoring with Prometheus and Grafana</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_prometheus_and_grafana">1. Prometheus and Grafana</a>
<ul class="sectlevel2">
<li><a href="#_prometheus">1.1. Prometheus</a></li>
<li><a href="#_prometheus_exporters">1.2. Prometheus Exporters</a></li>
<li><a href="#_grafana">1.3. Grafana</a></li>
</ul>
</li>
<li><a href="#_set_up_the_monitoring_server">2. Set up the Monitoring Server</a>
<ul class="sectlevel2">
<li><a href="#_install_prometheus">2.1. Install Prometheus</a></li>
<li><a href="#_install_grafana">2.2. Install Grafana</a></li>
</ul>
</li>
<li><a href="#_configure_suse_manager_monitoring">3. Configure SUSE Manager Monitoring</a>
<ul class="sectlevel2">
<li><a href="#_server_self_monitoring">3.1. Server Self Monitoring</a></li>
<li><a href="#_monitoring_managed_systems">3.2. Monitoring Managed Systems</a></li>
<li><a href="#_change_grafana_password">3.3. Change Grafana Password</a></li>
</ul>
</li>
<li><a href="#_network_boundaries">4. Network Boundaries</a>
<ul class="sectlevel2">
<li><a href="#_reverse_proxy_setup">4.1. Reverse Proxy Setup</a></li>
</ul>
</li>
<li><a href="#_security">5. Security</a>
<ul class="sectlevel2">
<li><a href="#_generating_tls_certificates">5.1. Generating TLS certificates</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can monitor your SUSE Manager environment using Prometheus and Grafana.
SUSE Manager Server and Proxy are able to provide self-health metrics.
You can also install and manage a number of Prometheus exporters on Salt clients.</p>
</div>
<div class="paragraph">
<p>Prometheus and Grafana packages are included in the SUSE Manager Client Tools for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SUSE Linux Enterprise&#160;12</p>
</li>
<li>
<p>SUSE Linux Enterprise&#160;15</p>
</li>
<li>
<p>openSUSE Leap 15.x</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You need to install Prometheus and Grafana on a machine separate from the SUSE Manager Server.
We recommend to use a managed Salt SUSE client as your monitoring server.
Other clients are not supported as a monitoring server.</p>
</div>
<div class="paragraph">
<p>Prometheus fetches metrics using a pull mechanism, so the server must be able to establish TCP connections to monitored clients.
Clients must have corresponding open ports and be reachable over the network.
Alternatively, you can use reverse proxies to establish a connection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must have a monitoring add-on subscription for each client you want to monitor.
Visit the SUSE Customer Center to manage your SUSE Manager subscriptions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prometheus_and_grafana"><a class="anchor" href="#_prometheus_and_grafana"></a><a class="link" href="#_prometheus_and_grafana">1. Prometheus and Grafana</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prometheus"><a class="anchor" href="#_prometheus"></a><a class="link" href="#_prometheus">1.1. Prometheus</a></h3>
<div class="paragraph">
<p>Prometheus is an open-source monitoring tool that is used to record real-time metrics in a time-series database.
Metrics are pulled via HTTP, enabling high performance and scalability.</p>
</div>
<div class="paragraph">
<p>Prometheus metrics are time series data, or timestamped values belonging to the same group or dimension.
A metric is uniquely identified by its name and set of labels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   metric name               labels                 timestamp     value
┌────────┴───────┐  ┌───────────┴───────────┐    ┌──────┴──────┐  ┌─┴─┐
http_requests_total{status="200", method="GET"}  @1557331801.111  42236</pre>
</div>
</div>
<div class="paragraph">
<p>Each application or system being monitored must expose metrics in the format above, either through code instrumentation or Prometheus exporters.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prometheus_exporters"><a class="anchor" href="#_prometheus_exporters"></a><a class="link" href="#_prometheus_exporters">1.2. Prometheus Exporters</a></h3>
<div class="paragraph">
<p>Exporters are libraries that help with exporting metrics from third-party systems as Prometheus metrics.
Exporters are useful whenever it is not feasible to instrument a given application or system with Prometheus metrics directly.
Multiple exporters can run on a monitored host to export local metrics.</p>
</div>
<div class="paragraph">
<p>The Prometheus community provides a list of official exporters, and more can be found as community contributions.
For more information and an extensive list of exporters, see <a href="https://prometheus.io/docs/instrumenting/exporters/" class="bare">https://prometheus.io/docs/instrumenting/exporters/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_grafana"><a class="anchor" href="#_grafana"></a><a class="link" href="#_grafana">1.3. Grafana</a></h3>
<div class="paragraph">
<p>Grafana is a tool for data visualization, monitoring, and analysis.
It is used to create dashboards with panels representing specific metrics over a set period of time.
Grafana is commonly used together with Prometheus, but also supports other data sources such as ElasticSearch, MySQL, PostgreSQL, and Influx DB.
For more information about Grafana, see <a href="https://grafana.com/docs/" class="bare">https://grafana.com/docs/</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_set_up_the_monitoring_server"><a class="anchor" href="#_set_up_the_monitoring_server"></a><a class="link" href="#_set_up_the_monitoring_server">2. Set up the Monitoring Server</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To set up your monitoring server, you need to install Prometheus and Grafana, and configure them.</p>
</div>
<div class="sect2">
<h3 id="_install_prometheus"><a class="anchor" href="#_install_prometheus"></a><a class="link" href="#_install_prometheus">2.1. Install Prometheus</a></h3>
<div class="paragraph">
<p>If your monitoring server is a Salt client, you can install the Prometheus package using the SUSE Manager Web UI.
Otherwise you can download and install the package on your monitoring server manually.
The Prometheus software is also available for SUSE Manager Proxy and SUSE Manager for Retail Branch Server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Prometheus expects POSIX filesystem for storing data.
Non-POSIX compliant filesystems are not supported.
NFS filesystems are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Installing Prometheus Using the Web UI</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, open the details page of the system where Prometheus is to be installed, and navigate to the <code class="guimenu">Formulas</code> tab.</p>
</li>
<li>
<p>Check the <code class="guimenu">Prometheus</code> checkbox to enable  monitoring formulas, and click <b class="button">Save</b>.</p>
</li>
<li>
<p>Navigate to the <code>Prometheus</code> tab in the top menu.</p>
</li>
<li>
<p>In the <code>SUSE Manager Server</code> section, enter valid SUSE Manager API credentials.
Make sure that the credentials you have entered allow access to the set of systems you want to monitor.</p>
</li>
<li>
<p>Customize any other configuration options according to your needs.</p>
</li>
<li>
<p>Click <b class="button">Save Formula</b>.</p>
</li>
<li>
<p>Apply the highstate and confirm that it completes successfully.</p>
</li>
<li>
<p>Check that the Prometheus interface loads correctly. In your browser, navigate to the URL of the server where Prometheus is installed, on port 9090 (for example, <code class="literal"><a href="http://example.com:9090" class="bare">http://example.com:9090</a></code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about the monitoring formulas, see <a href="../specialized-guides/salt/salt-formula-monitoring.html" class="xref page">Monitoring Formula</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Manually Installing and Configuring Prometheus</div>
<ol class="arabic">
<li>
<p>On the monitoring server, install the <code class="package">golang-github-prometheus-prometheus</code> package:</p>
<div class="listingblock">
<div class="content">
<pre>zypper in golang-github-prometheus-prometheus</pre>
</div>
</div>
</li>
<li>
<p>Enable the Prometheus service:</p>
<div class="listingblock">
<div class="content">
<pre>systemctl enable --now prometheus</pre>
</div>
</div>
</li>
<li>
<p>Check that the Prometheus interface loads correctly.
In your browser, navigate to the URL of the server where Prometheus is installed, on port 9090 (for example, <code class="literal"><a href="http://example.com:9090" class="bare">http://example.com:9090</a></code>).</p>
</li>
<li>
<p>Open the configuration file at <code class="path">/etc/prometheus/prometheus.yml</code> and add this configuration information.
Replace <code>server.url</code> with your SUSE Manager server URL and adjust <code>username</code> and <code>password</code> fields to match your SUSE Manager credentials.</p>
<div class="listingblock">
<div class="content">
<pre># {productname} self-health metrics
scrape_configs:
- job_name: 'mgr-server'
  static_configs:
    - targets:
      - 'server.url:9100'  # Node exporter
      - 'server.url:9187'  # PostgreSQL exporter
      - 'server.url:5556'  # JMX exporter (Tomcat)
      - 'server.url:5557'  # JMX exporter (Taskomatic)
      - 'server.url:9800'  # Taskomatic
    - targets:
      - 'server.url:80'    # Message queue
      labels:
        __metrics_path__: /rhn/metrics

# Managed systems metrics:
- job_name: 'mgr-clients'
  uyuni_sd_configs:
   - server: "http://server.url"
     username: "admin"
     password: "admin"
  relabel_configs:
   - source_labels: [__meta_uyuni_exporter]
     target_label: exporter
   - source_labels: [__address__]
     replacement: "No group"
     target_label: groups
   - source_labels: [__meta_uyuni_groups]
     regex: (.+)
     target_label: groups
   - source_labels: [__meta_uyuni_minion_hostname]
     target_label: hostname
   - source_labels: [__meta_uyuni_primary_fqdn]
     regex: (.+)
     target_label: hostname
   - source_labels: [hostname, __address__]
     regex: (.*);.*:(.*)
     replacement: ${1}:${2}
     target_label: __address__
   - source_labels: [__meta_uyuni_metrics_path]
     regex: (.+)
     target_label: __metrics_path__
   - source_labels: [__meta_uyuni_proxy_module]
     target_label: __param_module
   - source_labels: [__meta_uyuni_scheme]
     target_label: __scheme__</pre>
</div>
</div>
</li>
<li>
<p>Save the configuration file.</p>
</li>
<li>
<p>Restart the Prometheus service:</p>
<div class="listingblock">
<div class="content">
<pre>systemctl restart prometheus</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about the Prometheus configuration options, see the official Prometheus documentation at <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/" class="bare">https://prometheus.io/docs/prometheus/latest/configuration/configuration/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_install_grafana"><a class="anchor" href="#_install_grafana"></a><a class="link" href="#_install_grafana">2.2. Install Grafana</a></h3>
<div class="paragraph">
<p>If your monitoring server is a Salt client, you can install the Grafana package using the SUSE Manager Web UI.
Otherwise you can download and install the package on your monitoring server manually.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Grafana is not available on SUSE Manager Proxy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Installing Grafana Using the Web UI</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, open the details page of the system where Grafana is to be installed, and navigate to the <code class="guimenu">Formulas</code> tab.</p>
</li>
<li>
<p>Check the <code class="guimenu">Grafana</code> checkbox to enable  monitoring formulas, and click <b class="button">Save</b>.</p>
</li>
<li>
<p>Navigate to the <code>Grafana</code> tab in the top menu.</p>
</li>
<li>
<p>In the <code>Enable and configure Grafana</code> section, enter the admin credentials you want to use to log in Grafana.</p>
</li>
<li>
<p>On the <code>Datasources</code> section, make sure that the Prometheus URL field points to the system where Prometheus is running.</p>
</li>
<li>
<p>Customize any other configuration options according to your needs.</p>
</li>
<li>
<p>Click <b class="button">Save Formula</b>.</p>
</li>
<li>
<p>Apply the highstate and confirm that it completes successfully.</p>
</li>
<li>
<p>Check that the Grafana interface is loading correctly. In your browser, navigate to the URL of the server where Grafana is installed, on port 3000 (for example, <code class="literal"><a href="http://example.com:3000" class="bare">http://example.com:3000</a></code>).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SUSE Manager provides pre-built dashboards for server self-health, basic client monitoring, and more.
You can choose which dashboards to provision in the formula configuration page.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Manually Installing Grafana</div>
<ol class="arabic">
<li>
<p>Install the <code class="package">grafana</code> package:</p>
<div class="listingblock">
<div class="content">
<pre>zypper in grafana</pre>
</div>
</div>
</li>
<li>
<p>Enable the Grafana service:</p>
<div class="listingblock">
<div class="content">
<pre>systemctl enable --now grafana-server</pre>
</div>
</div>
</li>
<li>
<p>In your browser, navigate to the URL of the server where Grafana is installed, on port 3000 (for example, <code class="literal"><a href="http://example.com:3000" class="bare">http://example.com:3000</a></code>).</p>
</li>
<li>
<p>On the login page, enter <code>admin</code> for username and password.</p>
</li>
<li>
<p>Click <b class="button">Log in</b>.
If login is successful, then you will see a prompt to change the password.</p>
</li>
<li>
<p>Click <b class="button">OK</b> on the prompt, then change your password.</p>
</li>
<li>
<p>Move your cursor to the cog icon on the side menu which will show the configuration options.</p>
<div class="imageblock">
<div class="content">
<img src="_images/grafana_sidemenu_datasource.png" alt="grafana sidemenu datasource">
</div>
</div>
</li>
<li>
<p>Click <b class="button">Data sources</b>.</p>
</li>
<li>
<p>Click <b class="button">Add data source</b> to see a list of all supported data sources.</p>
</li>
<li>
<p>Choose the Prometheus data source.</p>
</li>
<li>
<p>Make sure to specify the correct URL of the Prometheus server.</p>
</li>
<li>
<p>Click <b class="button">Save &amp; test</b>.</p>
</li>
<li>
<p>To import a dashboard click the <b class="button">+</b> icon in the side menu, and then click <b class="button">Import</b>.</p>
</li>
<li>
<p>For SUSE Manager server overview load the dashboard ID: <code>17569</code>.</p>
</li>
<li>
<p>For SUSE Manager clients overview load the dashboard ID: <code>17570</code>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/monitoring_grafana_example.png" alt="monitoring grafana example">
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For more information about the monitoring formulas, see <a href="../specialized-guides/salt/salt-formula-monitoring.html" class="xref page">Monitoring Formula</a>.</p>
</li>
<li>
<p>For more information on how to manually install and configure Grafana, see <a href="https://grafana.com/docs" class="bare">https://grafana.com/docs</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_suse_manager_monitoring"><a class="anchor" href="#_configure_suse_manager_monitoring"></a><a class="link" href="#_configure_suse_manager_monitoring">3. Configure SUSE Manager Monitoring</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>With SUSE Manager&#160;4 and higher, you can enable the server to expose Prometheus self-health metrics, and also install and configure exporters on client systems.</p>
</div>
<div class="sect2">
<h3 id="_server_self_monitoring"><a class="anchor" href="#_server_self_monitoring"></a><a class="link" href="#_server_self_monitoring">3.1. Server Self Monitoring</a></h3>
<div class="paragraph">
<p>The Server self-health metrics cover hardware, operating system and SUSE Manager internals.
These metrics are made available by instrumentation of the Java application, combined with Prometheus exporters.</p>
</div>
<div class="paragraph">
<p>These exporter packages are shipped with SUSE Manager Server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node exporter: <code class="systemitem">golang-github-prometheus-node_exporter</code>.
See <a href="https://github.com/prometheus/node_exporter" class="bare">https://github.com/prometheus/node_exporter</a>.</p>
</li>
<li>
<p>PostgreSQL exporter: <code class="systemitem">prometheus-postgres_exporter</code>.
See <a href="https://github.com/wrouesnel/postgres_exporter" class="bare">https://github.com/wrouesnel/postgres_exporter</a>.</p>
</li>
<li>
<p>JMX exporter: <code class="systemitem">prometheus-jmx_exporter</code>.
See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a>.</p>
</li>
<li>
<p>Apache exporter: <code class="systemitem">golang-github-lusitaniae-apache_exporter</code>.
See <a href="https://github.com/Lusitaniae/apache_exporter" class="bare">https://github.com/Lusitaniae/apache_exporter</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These exporter packages are shipped with SUSE Manager Proxy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node exporter: <code class="systemitem">golang-github-prometheus-node_exporter</code>.
See <a href="https://github.com/prometheus/node_exporter" class="bare">https://github.com/prometheus/node_exporter</a>.</p>
</li>
<li>
<p>Squid exporter: <code class="systemitem">golang-github-boynux-squid_exporter</code>.
See <a href="https://github.com/boynux/squid-exporter" class="bare">https://github.com/boynux/squid-exporter</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The exporter packages are pre-installed in SUSE Manager Server and Proxy, but their respective systemd daemons are disabled by default.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Enabling Self Monitoring</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, navigate to <span class="menuseq"><b class="menu">Admin</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Manager Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Monitoring</b></span>.</p>
</li>
<li>
<p>Click <b class="button">Enable services</b>.</p>
</li>
<li>
<p>Restart Tomcat and Taskomatic.</p>
</li>
<li>
<p>Navigate to the URL of your Prometheus server, on port 9090 (for example, <code class="literal"><a href="http://example.com:9090" class="bare">http://example.com:9090</a></code>)</p>
</li>
<li>
<p>In the Prometheus UI, navigate to menu:[Status &gt; Targets] and confirm that all the endpoints on the <code>mgr-server</code> group are up.</p>
</li>
<li>
<p>If you have also installed Grafana with the Web UI, the server insights are visible on the SUSE Manager Server dashboard.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/monitoring_enable_services.png" alt="monitoring enable services">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only server self-health monitoring can be enabled using the Web UI.
Metrics for a proxy are not automatically collected by Prometheus.
To enable self-health monitoring on a proxy, you need to manually install exporters and enable them.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following relevant metrics are collected on the SUSE Manager Server.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Server statistics (port 80)</caption>
<colgroup>
<col style="width: 45%;">
<col style="width: 10%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uyuni_all_systems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of all systems</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uyuni_virtual_systems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of virtual systems</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uyuni_inactive_systems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of inactive systems</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uyuni_outdated_systems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of systems with outdated packages</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. PostgreSQL exporter (port 9187)</caption>
<colgroup>
<col style="width: 45%;">
<col style="width: 10%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pg_stat_database_tup_fetched</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of rows fetched by queries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pg_stat_database_tup_inserted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of rows inserted by queries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pg_stat_database_tup_updated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of rows updated by queries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pg_stat_database_tup_deleted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of rows deleted by queries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mgr_serveractions_completed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of completed actions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mgr_serveractions_failed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of failed actions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mgr_serveractions_picked_up</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of picked-up actions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mgr_serveractions_queued</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of queued actions</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. JMX exporter (Tomcat port 5556, Taskomatic port 5557)</caption>
<colgroup>
<col style="width: 45%;">
<col style="width: 10%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java_lang_Threading_ThreadCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of active threads</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java_lang_Memory_HeapMemoryUsage_used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current heap memory usage</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Server Message Queue (port 80)</caption>
<colgroup>
<col style="width: 45%;">
<col style="width: 10%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message_queue_thread_pool_threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of message queue threads ever created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message_queue_thread_pool_threads_active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of currently active message queue threads</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message_queue_thread_pool_task_count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of tasks ever submitted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message_queue_thread_pool_completed_task_count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of tasks ever completed</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Taskomatic Scheduler (port 9800)</caption>
<colgroup>
<col style="width: 45%;">
<col style="width: 10%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskomatic_scheduler_threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of scheduler threads ever created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskomatic_scheduler_threads_active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of currently active scheduler threads</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskomatic_scheduler_completed_task_count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of tasks ever completed</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_monitoring_managed_systems"><a class="anchor" href="#_monitoring_managed_systems"></a><a class="link" href="#_monitoring_managed_systems">3.2. Monitoring Managed Systems</a></h3>
<div class="paragraph">
<p>Prometheus metrics exporters can be installed and configured on Salt clients using formulas.
The packages are available from the SUSE Manager client tools channels, and can be enabled and configured directly in the SUSE Manager Web UI.</p>
</div>
<div class="paragraph">
<p>These exporters can be installed on managed systems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node exporter: <code class="systemitem">golang-github-prometheus-node_exporter</code>.
See <a href="https://github.com/prometheus/node_exporter" class="bare">https://github.com/prometheus/node_exporter</a>.</p>
</li>
<li>
<p>PostgreSQL exporter: <code class="systemitem">prometheus-postgres_exporter</code>.
See <a href="https://github.com/wrouesnel/postgres_exporter" class="bare">https://github.com/wrouesnel/postgres_exporter</a>.</p>
</li>
<li>
<p>Apache exporter: <code class="systemitem">golang-github-lusitaniae-apache_exporter</code>.
See <a href="https://github.com/Lusitaniae/apache_exporter" class="bare">https://github.com/Lusitaniae/apache_exporter</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On SLE Micro, only the Node exporter and the Blackbox exporter are available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you have the exporters installed and configured, you can start using Prometheus to collect metrics from monitored systems.
If you have configured your monitoring server with the Web UI, metrics collection happens automatically.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Configuring Prometheus Exporters on a Client</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, open the details page of the client to be monitored, and navigate to the menu:Formulas tab.</p>
</li>
<li>
<p>Check the <code class="guimenu">Enabled</code> checkbox on the <code>Prometheus Exporters</code> formula.</p>
</li>
<li>
<p>Click <b class="button">Save</b>.</p>
</li>
<li>
<p>Navigate to the <span class="menuseq"><b class="menu">Formulas</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Prometheus Exporters</b></span> tab.</p>
</li>
<li>
<p>Select the exporters you want to enable and customize arguments according to your needs.
The <code class="guimenu">Address</code> field accepts either a port number preceded by a colon (<code>:9100</code>), or a fully resolvable address (<code>example:9100</code>).</p>
</li>
<li>
<p>Click <b class="button">Save Formula</b>.</p>
</li>
<li>
<p>Apply the highstate.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/monitoring_configure_formula.png" alt="monitoring configure formula">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Monitoring formulas can also be configured for System Groups, by applying the same configuration used for individual systems inside the corresponding group.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information about the monitoring formulas, see <a href="../specialized-guides/salt/salt-formula-monitoring.html" class="xref page">Monitoring Formula</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_change_grafana_password"><a class="anchor" href="#_change_grafana_password"></a><a class="link" href="#_change_grafana_password">3.3. Change Grafana Password</a></h3>
<div class="paragraph">
<p>To change the Grafana password follow the steps described in the Grafana documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://grafana.com/docs/grafana/latest/administration/user-management/user-preferences/#change-your-grafana-password" class="bare">https://grafana.com/docs/grafana/latest/administration/user-management/user-preferences/#change-your-grafana-password</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In case you have lost the Grafana administrator password you can reset it as <code class="literal">root</code> with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grafana-cli --configOverrides cfg:default.paths.data=/var/lib/grafana --homepath /usr/share/grafana admin reset-admin-password &lt;new_password&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_boundaries"><a class="anchor" href="#_network_boundaries"></a><a class="link" href="#_network_boundaries">4. Network Boundaries</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prometheus fetches metrics using a pull mechanism, so the server must be able to establish TCP connections to monitored clients.
By default, Prometheus uses these ports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node exporter: 9100</p>
</li>
<li>
<p>PostgreSQL exporter: 9187</p>
</li>
<li>
<p>Apache exporter: 9117</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, if you are running the alert manager on a different host than where you run Prometheus, you also need to open port 9093.</p>
</div>
<div class="paragraph">
<p>For clients installed on cloud instances, you can add the required ports to a security group that has access to the monitoring server.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can deploy a Prometheus instance in the exporters' local network, and configure federation.
This allows the main monitoring server to scrape the time series from the local Prometheus instance.
If you use this method, you only need to open the Prometheus API port, which is 9090.</p>
</div>
<div class="paragraph">
<p>For more information on Prometheus federation, see <a href="https://prometheus.io/docs/prometheus/latest/federation/" class="bare">https://prometheus.io/docs/prometheus/latest/federation/</a>.</p>
</div>
<div class="paragraph">
<p>You can also proxy requests through the network boundary.
Tools like PushProx deploy a proxy and a client on both sides of the network barrier and allow Prometheus to work across network topologies such as NAT.</p>
</div>
<div class="paragraph">
<p>For more information on PushProx, see <a href="https://github.com/RobustPerception/PushProx" class="bare">https://github.com/RobustPerception/PushProx</a>.</p>
</div>
<div class="sect2">
<h3 id="_reverse_proxy_setup"><a class="anchor" href="#_reverse_proxy_setup"></a><a class="link" href="#_reverse_proxy_setup">4.1. Reverse Proxy Setup</a></h3>
<div class="paragraph">
<p>Prometheus fetches metrics using a pull mechanism, so the server must be able to establish TCP connections to each exporter on the monitored clients.
To simplify your firewall configuration, you can use reverse proxy for your exporters to expose all metrics on a single port.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Installing Prometheus Exporters with Reverse Proxy</div>
<ol class="arabic">
<li>
<p>In the SUSE Manager Web UI, open the details page of the system to be monitored, and navigate to the <code class="guimenu">Formulas</code> tab.</p>
</li>
<li>
<p>Check the <code class="guimenu">Prometheus Exporters</code> checkbox to enable the exporters formula, and click <b class="button">Save</b>.</p>
</li>
<li>
<p>Navigate to the <code>Prometheus Exporters</code> tab in the top menu.</p>
</li>
<li>
<p>Check the <code class="guimenu">Enable reverse proxy</code> option, and enter a valid reverse proxy port number.
For example, <code>9999</code>.</p>
</li>
<li>
<p>Customize the other exporters according to your needs.</p>
</li>
<li>
<p>Click <b class="button">Save Formula</b>.</p>
</li>
<li>
<p>Apply the highstate and confirm that it completes successfully.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about the monitoring formulas, see <a href="../specialized-guides/salt/salt-formula-monitoring.html" class="xref page">Monitoring Formula</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security"><a class="anchor" href="#_security"></a><a class="link" href="#_security">5. Security</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prometheus server and Prometheus node exporter offer a built-in mechanism to secure their endpoints with TLS encryption and authentication.
SUSE Manager Web UI simplifies the configuration of all involved components. The TLS certificates have to be provided and deployed by the user.
SUSE Manager offers enabling the following security model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node exporter: TLS encryption and client certificate based authentication</p>
</li>
<li>
<p>Prometheus: TLS encryption and basic authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about configuring all available options, see <a href="../specialized-guides/salt/salt-formula-monitoring.html" class="xref page">Monitoring Formula</a>.</p>
</div>
<div class="sect2">
<h3 id="_generating_tls_certificates"><a class="anchor" href="#_generating_tls_certificates"></a><a class="link" href="#_generating_tls_certificates">5.1. Generating TLS certificates</a></h3>
<div class="paragraph">
<p>By default, SUSE Manager does not provide any certificates for securing monitoring configuration.
For providing security, you can generate or import custom certificates, self-signed or signed by a third party certificate authority (CA).</p>
</div>
<div class="paragraph">
<p>This section demonstrates how to generate client/server certificates for Prometheus and Node exporter minions self-signed with SUSE Manager CA.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Creating server/client TLS certificate</div>
<ol class="arabic">
<li>
<p>On the SUSE Manager Server, at the command prompt, run following command:</p>
<div class="listingblock">
<div class="content">
<pre>rhn-ssl-tool --gen-server --dir="/root/ssl-build" --set-country="COUNTRY" \
--set-state="STATE" --set-city="CITY" --set-org="ORGANIZATION" \
--set-org-unit="ORGANIZATION UNIT" --set-email="name@example.com" \
--set-hostname="minion.example.com" --set-cname="minion.example.com" --no-rpm</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that the <code class="systemitem">set-cname</code> parameter is the fully qualified domain name (FQDN) of your Salt client.
You can use the the <code class="systemitem">set-cname</code> parameter multiple times if you require multiple aliases.</p>
</div>
</li>
<li>
<p>Copy <code>server.crt</code> and <code>server.key</code> files to the Salt minion and provide read access for <code>prometheus</code> user.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
<script src="../../_/js/vendor/langSelection.js"></script>

  </body>
</html>
