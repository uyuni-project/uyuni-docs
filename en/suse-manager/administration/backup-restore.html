<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<title>Backup and Restore
     | SUSE Manager 4.3 Documentation</title>    <link rel="canonical" href="https://documentation.suse.com/suma/4.3/en/suse-manager/administration/backup-restore.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/search.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../_/css/font-styles.css">
<link rel="stylesheet" href="../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../_/css/site-extra.css">
<!-- <link rel="preconnect" href="https://fonts.gstatic.com"> -->
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js"
        type="text/javascript"></script>
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
   <div class="navbar-brand">
            <div class="navbar-item">
                <a class=" navbar-logo" href="https://documentation.suse.com/suma/"><img
                        class="logo" src="../../_/img/logo.svg"/></a>
            </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
     <div id="topbar-nav" class="navbar-menu">
          <div class="navbar-end">
              <div class="navbar-item has-dropdown is-hoverable">
                  <div class="navbar-link"><img src="../../_/img/resources.png" class="langIcon Resurces" alt="Resources" title="Resources"></div>
                  <div class="navbar-dropdown">
                      <!--  <div class="navbar-item"><strong>Resources</strong></div> -->
                      <a class="navbar-item" href="https://github.com/uyuni-project/uyuni-docs"><i
                              class="fab fa-github"></i>&nbsp;uyuni-docs</a>
                      <a class="navbar-item" href="https://github.com/uyuni-project/uyuni-docs/issues"><i
                              class="fab fa-github"></i>&nbsp;Report Issue</a>
                      <a class="navbar-item"
                         href="https://github.com/uyuni-project/uyuni-docs/wiki"><i
                              class="fas fa-user-edit"></i>&nbsp;Contribute</a>
                  </div>
              </div>
                           <div class="navbar-item has-dropdown is-hoverable">
                 <div class="navbar-link"><img src="../../_/img/language.png" class="langIcon Language" alt="Language" title="Language"></div>
                 <div class="navbar-dropdown">
                     <!--  </div><div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->
                     <a role="button" class="navbar-item" id="en" onclick="selectLanguage(this.id)"><img src="../../_/img/engFlag.svg" class="langIcon english">&nbsp;English</a>
                     <!-- LANGUAGESELECTOR -->
                     <a role="button" class="navbar-item" id="ko" onclick="selectLanguage(this.id)"><img src="../../_/img/koFlag.svg" class="langIcon korea">&nbsp;한국어</a>
                     <a role="button" class="navbar-item" id="ja" onclick="selectLanguage(this.id)"><img src="../../_/img/jaFlag.svg" class="langIcon japan">&nbsp;日本語</a>
                     <a role="button" class="navbar-item" id="zh_CN" onclick="selectLanguage(this.id)"><img src="../../_/img/china.svg" class="langIcon china">&nbsp;中文</a>
                 </div>
             </div>
                
          </div>
      </div>
      <a id="twitter-link" class="navbar-item" href="https://twitter.com/susemanager">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 512 512">
              <path fill="#57aaee"
                    d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
      </a>
   <!--   <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
      </div> -->
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="suse-manager" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">SUSE Manager 4.3 Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../common_gfdl1.2_i.html">License</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/specialized-guides-overview.html">Specialized Guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/overview.html">Public Cloud Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Generic Public Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/setup.html">Initial Setup</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/clients.html">Client Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">PAYG Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-overview.html">Pay-as-you-go Overview</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-benefits.html">Benefits of PAYG</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">PAYG on AWS</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-faq.html">PAYG FAQ on AWS</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-country-listing.html">Supported Country List</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-aws-requirements.html">SUSE Manager AWS requirements</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-find-the-aws-image.html">Find the Image</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-configure-the-image.html">Configure the Image on EC2</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-start-the-image.html">Start the Instance</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-initial-setup.html">Initial Setup</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-start-the-server.html">Start the Server</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../specialized-guides/public-cloud-guide/payg/payg-webui-configuration.html">WebUI Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/salt/salt-overview.html">Salt Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-command.html">Salt Command</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-useful-commands.html">Common Salt Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-states-and-pillars.html">Salt States and Pillars</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-gpg-encrypted-pillars.html">GPG Encrypted Pillars</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-custom-states.html">Custom Salt States</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-file-locations.html">File Locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-gitfs.html">GitFS Fileserver Backend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-yomi.html">Install Using Yomi</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-config-modules.html">Configuration Modules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/salt/salt-formulas-intro.html">Salt Formulas</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formulas-by-product.html">Formulas provided by SUSE Manager</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-bind.html">Bind Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-branchnetwork.html">Branch Network Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-dhcpd.html">DHCPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-imagesync.html">Image Sync Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-monitoring.html">Monitoring Formulas</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-pxe.html">PXE Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-saltboot.html">Saltboot Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-tftpd.html">TFTPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-vsftpd.html">VsFTPd Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formula-yomi.html">Yomi Formula</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/salt/salt-formulas-custom.html">Custom Salt Formulas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-ssh.html">Salt SSH</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-rate-limiting.html">Rate Limiting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/salt/salt-scaling-minions.html">Scaling Minions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/large-deployments/overview.html">Large Deployments Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/large-deployments/hardware-reqs.html">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/large-deployments/single-server.html">Single Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/operation-reqs.html">Operation Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/large-deployments/multi-server.html">Multiple Servers with Hub</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-reqs.html">Hub Operation Requirements</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-install.html">Hub Installation</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-api.html">Hub API</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-namespaces.html">Hub Namespaces</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-auth.html">Hub Authentication</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../specialized-guides/large-deployments/hub-reporting.html">Hub Reporting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/large-deployments/retail-large-scale.html">Large Retail Environments</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/large-deployments/tuning.html">Tuning Large Installations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text">xref:large-deployments/monitoring.adoc[Monitoring Large Scale Deployments</span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../specialized-guides/qs-sap/overview.html">Quick Start: SAP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/qs-sap/prepare-server.html">Prepare Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/qs-sap/prepare-clients.html">Prepare Clients</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../specialized-guides/qs-sap/configure.html">Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE Manager 4.3 Documentation</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">SUSE Manager 4.3 Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">SUSE Manager 4.3 Documentation</a></li>
    <li><a href="backup-restore.html">Backup and Restore</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Backup and Restore</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#backup-restore-product">1. Back up SUSE Manager</a></li>
<li><a href="#backup.smdba.admin">2. Administering the Database with smdba</a></li>
<li><a href="#backup.smdba.backup">3. Database Backup with smdba</a>
<ul class="sectlevel2">
<li><a href="#_perform_a_manual_database_backup">3.1. Perform a Manual Database Backup</a></li>
<li><a href="#smdba.automatic.backup.with.cron">3.2. Scheduling Automatic Backups</a></li>
</ul>
</li>
<li><a href="#backup.smdba.restore">4. Restore from Backup</a></li>
<li><a href="#config-smdb.archivelog">5. Archive Log Settings</a></li>
<li><a href="#config-smdb.spaces">6. Retrieve an Overview of Occupied Database Space</a></li>
<li><a href="#_move_the_database">7. Move the Database</a></li>
<li><a href="#config-smdb.recover-root">8. Recover From a Crashed Root Partition</a></li>
<li><a href="#_database_connection_information">9. Database Connection Information</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Back up your SUSE Manager installation regularly, to prevent data loss.
Because SUSE Manager relies on a database as well as the installed program and configurations, it is important to back up all components of your installation.
This chapter contains information on the files you need to back up, and introduces the <code class="command">smdba</code> tool to manage database backups.
It also contains information about restoring from your backups in the case of a system failure.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Regardless of the backup method you use, you must have available at least three times the amount of space your current installation uses.
Running out of space can result in backups failing, so check this often.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup-restore-product"><a class="anchor" href="#backup-restore-product"></a><a class="link" href="#backup-restore-product">1. Back up SUSE Manager</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most comprehensive method for backing up your SUSE Manager installation is to back up the relevant files and directories.
This can save you time in administering your backup, and can be faster to reinstall and re-synchronize in the case of failure.
However, this method requires significant disk space and could take a long time to perform the backup.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to back up only the required files and directories, use the following list.
To make this process simpler, and more comprehensive, we recommend backing up the entire <code class="path">/etc</code> and <code class="path">/root</code> directories, not just the ones specified here.
Some files only exist if you are actually using the related SUSE Manager feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="path">/etc/cobbler/</code></p>
</li>
<li>
<p><code class="path">/etc/dhcp.conf</code></p>
</li>
<li>
<p><code class="path">/etc/fstab</code> and any ISO mount points you require.</p>
<div class="paragraph">
<p>If your UUID has changed, ensure you have updated the <code>fstab</code> entries  accordingly.</p>
</div>
</li>
<li>
<p><code class="path">/etc/rhn/</code></p>
</li>
<li>
<p><code class="path">/etc/salt</code></p>
</li>
<li>
<p><code class="path">/etc/sudoers</code></p>
</li>
<li>
<p><code class="path">/etc/sysconfig/rhn/</code></p>
</li>
<li>
<p><code class="path">/root/.gnupg/</code></p>
</li>
<li>
<p><code class="path">/root/.ssh</code></p>
<div class="paragraph">
<p>This file exists if you are using an SSH tunnel or SSH <code class="command">push</code>.
You also need to have saved a copy of the <code>id-susemanager</code> key.</p>
</div>
</li>
<li>
<p><code class="path">/root/ssl-build/</code></p>
</li>
<li>
<p><code class="path">/srv/formula_metadata</code></p>
</li>
<li>
<p><code class="path">/srv/pillar</code></p>
</li>
<li>
<p><code class="path">/srv/salt</code></p>
</li>
<li>
<p><code class="path">/srv/susemanager</code></p>
</li>
<li>
<p><code class="path">/srv/tftpboot/</code></p>
</li>
<li>
<p><code class="path">/srv/www/cobbler</code></p>
</li>
<li>
<p><code class="path">/srv/www/htdocs/pub/</code></p>
</li>
<li>
<p><code class="path">/srv/www/os-images</code></p>
</li>
<li>
<p><code class="path">/var/cache/rhn</code></p>
</li>
<li>
<p><code class="path">/var/cache/salt</code></p>
</li>
<li>
<p><code class="path">/var/lib/cobbler/</code></p>
</li>
<li>
<p><code class="path">/var/lib/cobbler/templates/</code> (before version 4.0 it is <code class="path">/var/lib/rhn/kickstarts/</code>)</p>
</li>
<li>
<p><code class="path">/var/lib/Kiwi</code></p>
</li>
<li>
<p><code class="path">/var/lib/rhn/</code></p>
</li>
<li>
<p><code class="path">/var/run/pgsql/</code></p>
</li>
<li>
<p><code class="path">/var/lib/salt/</code></p>
</li>
<li>
<p><code class="path">/var/run/salt/</code></p>
</li>
<li>
<p><code class="path">/var/spacewalk/</code></p>
</li>
<li>
<p>Any directories containing custom data such as scripts, Kickstart or AutoYaST profiles, and custom RPMs.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You also need to back up your database, which you can do with the <code class="command">smdba</code> tool.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Restoring from a Manual Backup</div>
<ol class="arabic">
<li>
<p>Re-install the SUSE Manager Server.
For more information, see <a href="../installation-and-upgrade/install-server-unified.html" class="xref page">Install SUSE Manager 4.3 Server</a>.</p>
</li>
<li>
<p>Set up the SUSE Manager Server with <code>yast2 susemanager_setup</code>.
For more information, see <a href="../installation-and-upgrade/server-setup.html" class="xref page">SUSE Manager Server Setup</a>.</p>
</li>
<li>
<p>Re-synchronize your SUSE Manager repositories using either the SUSE Manager Web UI, or with the <code class="command">mgr-sync</code> tool at the command prompt.
You can choose to re-register your product, or skip the registration and SSL certificate generation sections.</p>
</li>
<li>
<p>Re-install the <code class="path">/root/ssl-build/rhn-org-httpd-ssl-key-pair-MACHINE_NAME-VER-REL.noarch.rpm</code> package.</p>
</li>
<li>
<p>Schedule the re-creation of search indexes next time the <code class="command">rhn-search</code> service is started.
This command produces only debug messages, it does not produce error messages:</p>
<div class="listingblock">
<div class="content">
<pre>rhn-search cleanindex</pre>
</div>
</div>
</li>
<li>
<p>Check whether you need to restore <code class="path">/var/spacewalk/packages/</code>.
If <code class="path">/var/spacewalk/packages/</code> was not in your backup, you need to restore it.
If the source repository is available, you can restore <code class="path">/var/spacewalk/packages/</code> with a complete channel synchronization:</p>
<div class="listingblock">
<div class="content">
<pre>mgr-sync refresh --refresh-channels</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup.smdba.admin"><a class="anchor" href="#backup.smdba.admin"></a><a class="link" href="#backup.smdba.admin">2. Administering the Database with smdba</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code class="command">smdba</code> tool is used for managing a local PostgreSQL database.
It allows you to back up and restore your database, and manage backups.
It can also be used to check the status of your database, and perform administration tasks, such as restarting.
For more information about the <code class="command">smdba</code>  tool, see <a href="#reference:cli-smdba">[reference:cli-smdba]</a>.</p>
</div>
<div class="paragraph">
<p>The <code class="command">smdba</code> tool works with local PostgreSQL databases only, it does not work with remotely accessed databases, or Oracle databases.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code class="command">smdba</code> tool requires <code class="command">sudo</code> access, to execute system changes.
Ensure you have enabled <code class="command">sudo</code> access for the <code class="username">admin</code> user before you begin, by checking the <code class="path">/etc/sudoers</code> file for this line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>admin   ALL=(postgres) /usr/bin/smdba</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Check the runtime status of your database with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba db-status</pre>
</div>
</div>
<div class="paragraph">
<p>This command returns either <code>online</code> or <code>offline</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Checking database core...       online</pre>
</div>
</div>
<div class="paragraph">
<p>Starting and stopping the database can be performed with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba db-start</pre>
</div>
</div>
<div class="paragraph">
<p>And:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba db-stop</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup.smdba.backup"><a class="anchor" href="#backup.smdba.backup"></a><a class="link" href="#backup.smdba.backup">3. Database Backup with smdba</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code class="command">smdba</code> tool performs a continuous archiving backup.
This backup method combines a log of every change made to the database during the current session, with a series of more traditional backup files.
When a crash occurs, the database state is first restored from the most recent backup file on disk, then the log of the current session is replayed exactly, to bring the database back to a current state.
A continuous archiving backup with <code class="command">smdba</code> is performed with the database running, so there is no need for downtime.</p>
</div>
<div class="paragraph">
<p>This method of backing up is stable and generally creates consistent snapshots, however it can take up a lot of storage space.
Ensure you have at least three times the current database size of space available for backups.
You can check your current database size by navigating to <code class="path">/var/lib/pgsql/</code> and running <code class="command">df -h</code>.</p>
</div>
<div class="paragraph">
<p>The <code class="command">smdba</code> tool also manages your archives, keeping only the most recent backup, and the current archive of logs.
The log files can only be a maximum file size of 16&#160;MB, so a new log file is created when the files reach this size.
Every time you create a new backup, previous backups are purged to release disk space.
We recommend you use <code class="command">cron</code> to schedule your <code class="command">smdba</code> backups to ensure that your storage is managed effectively, and you always have a backup ready in case of failure.</p>
</div>
<div class="sect2">
<h3 id="_perform_a_manual_database_backup"><a class="anchor" href="#_perform_a_manual_database_backup"></a><a class="link" href="#_perform_a_manual_database_backup">3.1. Perform a Manual Database Backup</a></h3>
<div class="paragraph">
<p>The <code class="command">smdba</code> tool can be run directly from the command line.
We recommend you run a manual database backup immediately after installation, or if you have made any significant changes to your configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When <code class="command">smdba</code> is run for the first time, or if you have changed the location of the backup, it needs to restart your database before performing the archive.
This results in a small amount of downtime.
Regular database backups do not require any downtime.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Performing a Manual Database Backup</div>
<ol class="arabic">
<li>
<p>Allocate permanent storage space for your backup.
This example uses a directory located at <code class="path">/var/spacewalk/</code>.
This becomes a permanent target for your backup, so ensure it remains accessible by your server at all times.</p>
</li>
<li>
<p>In your backup location, create a directory for the backup:</p>
<div class="paragraph">
<p>As root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>install -d -o postgres -g postgres -m 700 /var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>Ensure you have the correct permissions set on the backup location:</p>
<div class="listingblock">
<div class="content">
<pre>chown postgres:postgres /var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>To create a backup for the first time, run the <code class="command">smdba backup-hot</code> command with the <code class="option">enable</code> option set.
This creates the backup in the specified directory, and, if necessary, restart the database:</p>
<div class="listingblock">
<div class="content">
<pre>smdba backup-hot --enable=on --backup-dir=/var/spacewalk/db-backup</pre>
</div>
</div>
<div class="paragraph">
<p>This command produces debug messages and finishes sucessfully with the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO: Finished</pre>
</div>
</div>
</li>
<li>
<p>Check that the backup files exist in the <code class="path">/var/spacewalk/db-backup</code> directory, to ensure that your backup has been successful.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="smdba.automatic.backup.with.cron"><a class="anchor" href="#smdba.automatic.backup.with.cron"></a><a class="link" href="#smdba.automatic.backup.with.cron">3.2. Scheduling Automatic Backups</a></h3>
<div class="paragraph">
<p>You do not need to shut down your system to perform a database backup with <code class="command">smdba</code>.
However, because it is a large operation, database performance can slow down while the backup is running.
We recommend you schedule regular database backups for a low-traffic period, to minimize disruption.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure you have at least three times the current database size of space available for backups.
You can check your current database size by navigating to <code class="path">/var/lib/pgsql/</code> and running <code class="command">df -h</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Scheduling Automatic Backups</div>
<ol class="arabic">
<li>
<p>Create a directory for the backup, and set the appropriate permissions (as root):</p>
<div class="listingblock">
<div class="content">
<pre>install -m 700 -o postgres -g postgres /var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>Open <code class="path">/etc/cron.d/db-backup-mgr</code>, or create it if it does not exist, and add the following line to create the cron job:</p>
<div class="listingblock">
<div class="content">
<pre>0 2 * * * root /usr/bin/smdba backup-hot --enable=on --backup-dir=/var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>Check the backup directory regularly to ensure the backups are working as expected.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup.smdba.restore"><a class="anchor" href="#backup.smdba.restore"></a><a class="link" href="#backup.smdba.restore">4. Restore from Backup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code class="command">smdba</code> tool can be used to restore from backup in the case of failure.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Restoring from Backup</div>
<ol class="arabic">
<li>
<p>Shut down the database:</p>
<div class="listingblock">
<div class="content">
<pre>smdba db-stop</pre>
</div>
</div>
</li>
<li>
<p>Start the restore process and wait for it to complete:</p>
<div class="listingblock">
<div class="content">
<pre>smdba backup-restore start</pre>
</div>
</div>
</li>
<li>
<p>Restart the database:</p>
<div class="listingblock">
<div class="content">
<pre>smdba db-start</pre>
</div>
</div>
</li>
<li>
<p>Check if there are differences between the RPMs and the database.</p>
<div class="listingblock">
<div class="content">
<pre>spacewalk-data-fsck</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config-smdb.archivelog"><a class="anchor" href="#config-smdb.archivelog"></a><a class="link" href="#config-smdb.archivelog">5. Archive Log Settings</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Archive logging allows the database management tool <code class="command">smdba</code> to perform hot backups.
In SUSE Manager with an embedded database, archive logging is enabled by default.</p>
</div>
<div class="paragraph">
<p>PostgreSQL maintains a limited number of archive logs.
Using the default configuration, approximately 64 files with a size of 16 MiB are stored.</p>
</div>
<div class="paragraph">
<p>Creating a user and syncing the channels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SLES12-SP2-Pool-x86_64</p>
</li>
<li>
<p>SLES12-SP2-Updates-x86_64</p>
</li>
<li>
<p>SLE-Manager-Tools12-Pool-x86_64-SP2</p>
</li>
<li>
<p>SLE-Manager-Tools12-Updates-x86_64-SP2</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PostgreSQL generates an additional roughly 1 GB of data.
So it is important to think about a backup strategy and create a backups in a regular way.</p>
</div>
<div class="paragraph">
<p>Archive logs are stored at <code class="path">/var/lib/pgsql/data/pg_xlog/</code> (postgresql).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config-smdb.spaces"><a class="anchor" href="#config-smdb.spaces"></a><a class="link" href="#config-smdb.spaces">6. Retrieve an Overview of Occupied Database Space</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Database administrators may use the subcommand <code class="command">space-overview</code> to get a report about occupied table spaces, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba space-overview</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUSE Manager Database Control. Version 1.5.2
Copyright (c) 2012 by SUSE Linux Products GmbH

Tablespace  | Size (Mb) | Avail (Mb) | Use %
------------+-----------+------------+------
postgres    | 7         | 49168      | 0.013
susemanager | 776       | 48399      | 1.602</pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="command">smdba</code> command is available for PostgreSQL.
For a more detailed report, use the <code class="command">space-tables</code> subcommand.
It lists the table and its size, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba space-tables</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUSE Manager Database Control. Version 1.5.2
Copyright (c) 2012 by SUSE Linux Products GmbH

Table                                 | Size
--------------------------------------+-----------
public.all_primary_keys               | 0 bytes
public.all_tab_columns                | 0 bytes
public.allserverkeywordsincereboot    | 0 bytes
public.dblink_pkey_results            | 0 bytes
public.dual                           | 8192 bytes
public.evr_t                          | 0 bytes
public.log                            | 32 kB
...</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_move_the_database"><a class="anchor" href="#_move_the_database"></a><a class="link" href="#_move_the_database">7. Move the Database</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to move the database to another location.
For example, if database storage space is running low.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Moving the Database</div>
<ol class="arabic">
<li>
<p>The default storage location for SUSE Manager is <code class="path">/var/lib/pgsql/</code>. If you would like to move it, for example to <code class="path">/storage/postgres/</code>, proceed as follows.</p>
</li>
<li>
<p>At the command prompt, as root, stop the running database:</p>
<div class="listingblock">
<div class="content">
<pre>rcpostgresql stop</pre>
</div>
</div>
<div class="paragraph">
<p>Shut down the running spacewalk services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spacewalk-service stop</pre>
</div>
</div>
</li>
<li>
<p>Copy the current working directory structure with <code class="command">cp</code> using the <code class="option">-a, --archive</code> option.
For example:</p>
<div class="listingblock">
<div class="content">
<pre>cp --archive /var/lib/pgsql/ /storage/postgres/</pre>
</div>
</div>
<div class="paragraph">
<p>This command copies the contents of <code class="path">/var/lib/pgsql/</code>
to <code class="path">/storage/postgres/pgsql/</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The contents of the <code class="path">/var/lib/pgsql</code> directory needs to remain the same, otherwise the SUSE Manager database may malfunction.
You also should ensure that there is enough available disk space.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Mount the new database directory:</p>
<div class="listingblock">
<div class="content">
<pre>mount /storage/postgres/pgsql</pre>
</div>
</div>
</li>
<li>
<p>Make sure ownership is <code>postgres:postgres</code> and not <code>root:root</code> by changing to the new directory and running these commands:</p>
<div class="listingblock">
<div class="content">
<pre>cd /storage/postgres/pgsql/
ls -l</pre>
</div>
</div>
<div class="paragraph">
<p>Outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>total 8
drwxr-x---  4 postgres postgres   47 Jun  2 14:35 ./</pre>
</div>
</div>
</li>
<li>
<p>Add the new database mount location to your servers fstab by editing  <code class="path">etc/fstab</code>.</p>
</li>
<li>
<p>Start the database with:</p>
<div class="listingblock">
<div class="content">
<pre>rcpostgresql start</pre>
</div>
</div>
</li>
<li>
<p>Start the spacewalk services:</p>
<div class="listingblock">
<div class="content">
<pre>spacewalk-service start</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config-smdb.recover-root"><a class="anchor" href="#config-smdb.recover-root"></a><a class="link" href="#config-smdb.recover-root">8. Recover From a Crashed Root Partition</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your root partition has crashed, you can restart the SUSE Manager Server with some additional steps.
This section assumes you have setup your server using separate partitions for the database and for channels, mounted at <code class="path">/var/lib/pgsql</code> and <code class="path">/var/spacewalk/</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After a new installation of a system most users and groups get different IDs.
Most backup systems store the names instead of the IDs and will restore the files with the correct ownership and permissions.
But if you mount existing partitions, you must align the ownership to the new system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Recovering from a Crashed Root Partition</div>
<ol class="arabic">
<li>
<p>Install SUSE Manager.
Do not mount the <code class="path">/var/spacewalk</code> and <code class="path">/var/lib/pgsql</code> partitions.
Wait for the installation to complete before going on to the next step.</p>
</li>
<li>
<p>Shut down the database:</p>
<div class="listingblock">
<div class="content">
<pre>rcpostgresql stop</pre>
</div>
</div>
</li>
<li>
<p>Shut down the services:</p>
<div class="listingblock">
<div class="content">
<pre>spacewalk-service stop</pre>
</div>
</div>
</li>
<li>
<p>Mount <code class="path">/var/spacewalk</code> and <code class="path">/var/lib/pgsql</code> partitions.</p>
</li>
<li>
<p>Restore the directories listed in <a href="#backup-restore-product">Back up SUSE Manager</a>.</p>
</li>
<li>
<p>Start the database:</p>
<div class="listingblock">
<div class="content">
<pre>rcpostgresql start</pre>
</div>
</div>
</li>
<li>
<p>Start the spacewalk services:</p>
<div class="listingblock">
<div class="content">
<pre>spacewalk-service start</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>SUSE Manager should now operate normally without loss of your database or synchronized channels.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database_connection_information"><a class="anchor" href="#_database_connection_information"></a><a class="link" href="#_database_connection_information">9. Database Connection Information</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can set information for connecting to the SUSE Manager database by adding or editing these variable in <code class="path">/etc/rhn/rhn.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>db_backend = postgresql
db_user = susemanager
db_password = susemanager
db_name = susemanager
db_host = localhost
db_port = 5432
db_ssl_enabled =</pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
<script src="../../_/js/vendor/langSelection.js"></script>

  </body>
</html>
